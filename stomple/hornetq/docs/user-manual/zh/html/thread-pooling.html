<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;41.&nbsp;&#32447;&#31243;&#31649;&#29702;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="libaio.html" title="Chapter&nbsp;40.&nbsp;Libaio&#24179;&#21488;&#19987;&#26377;&#24211;"><link rel="next" href="logging.html" title="Chapter&nbsp;42.&nbsp;&#26085;&#24535;&#65288;Logging&#65289;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;41.&nbsp;&#32447;&#31243;&#31649;&#29702;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="libaio.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="logging.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="thread-pooling"></a>Chapter&nbsp;41.&nbsp;&#32447;&#31243;&#31649;&#29702;</h2></div></div><div></div></div><p>&#26412;&#31456;&#35762;&#36848;HornetQ&#22914;&#20309;&#20351;&#29992;&#32447;&#31243;&#27744;&#20197;&#21450;&#22914;&#20309;&#31649;&#29702;&#32447;&#31243;&#12290;</p><p>&#39318;&#20808;&#25105;&#20204;&#35752;&#35770;&#22312;&#26381;&#21153;&#22120;&#31471;&#32447;&#31243;&#26159;&#22914;&#20309;&#34987;&#31649;&#29702;&#30340;&#65292;&#28982;&#21518;&#25105;&#20204;&#20877;&#35752;&#35770;&#23458;&#25143;&#31471;&#30340;&#24773;&#20917;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10316"></a>41.1.&nbsp;&#26381;&#21153;&#22120;&#31471;&#32447;&#31243;&#30340;&#31649;&#29702;</h2></div></div><div></div></div><p>&#27599;&#20010;HornetQ&#26381;&#21153;&#22120;&#37117;&#26377;&#19968;&#20010;&#32447;&#31243;&#27744;&#20316;&#20026;&#19968;&#33324;&#32447;&#31243;&#20351;&#29992;&#65292;&#21478;&#22806;&#36824;&#26377;&#19968;&#20010;&#21487;&#35745;&#21010;&#32447;&#31243;&#27744;&#12290;Java&#30340;&#21487;&#35745;&#21010;&#32447;&#31243;&#27744;&#19981;&#33021;&#20316;&#20026;
            &#26631;&#20934;&#30340;&#32447;&#31243;&#27744;&#20351;&#29992;&#65292;&#22240;&#27492;&#25105;&#20204;&#37319;&#29992;&#20102;&#20004;&#20010;&#21333;&#29420;&#30340;&#32447;&#31243;&#27744;&#12290;</p><p>&#24403;&#20351;&#29992;&#26087;&#30340;&#65288;&#38459;&#22622;&#65289;IO&#26102;&#65292;&#20351;&#29992;&#20102;&#19968;&#20010;&#21333;&#29420;&#30340;&#32447;&#31243;&#27744;&#26469;&#22788;&#29702;&#36830;&#25509;&#12290;&#20294;&#26159;&#26087;&#30340;IO&#35201;&#27714;&#19968;&#20010;&#32447;&#31243;&#37197;&#19968;&#20010;&#36830;&#25509;&#65292;&#25152;&#20197;&#22914;&#26524;&#20320;
            &#30340;&#24212;&#29992;&#26377;&#24456;&#22810;&#24182;&#21457;&#30340;&#36830;&#25509;&#65292;&#36825;&#20010;&#32447;&#31243;&#27744;&#20250;&#24456;&#24555;&#29992;&#20809;&#25152;&#26377;&#30340;&#32447;&#31243;&#65292;&#36896;&#25104;&#26381;&#21153;&#22120;&#20986;&#29616;&#8220;&#25346;&#36215;&#8221;&#29616;&#35937;&#12290;&#22240;&#27492;&#65292;&#23545;&#20110;&#22823;&#37327;&#24182;&#21457;&#36830;&#25509;
            &#30340;&#24212;&#29992;&#65292;&#19968;&#23450;&#35201;&#20351;&#29992;NIO&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;NIO&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;HornetQ&#20250;&#20351;&#29992;&#31995;&#32479;&#20013;&#22788;&#29702;&#22120;&#20869;&#26680;&#65288;&#25110;&#36229;&#32447;&#31243;&#65289;&#25968;&#37327;&#19977;&#20493;&#30340;&#32447;&#31243;&#26469;&#22788;&#29702;&#25509;&#25910;&#30340;&#25968;&#25454;&#21253;&#12290;
            &#20869;&#26680;&#30340;&#25968;&#37327;&#26159;&#36890;&#36807;&#35843;&#29992;<tt class="literal">Runtime.getRuntime().availableProcessors()</tt>&#26469;&#24471;&#21040;
            &#30340;&#12290;&#22914;&#26524;&#20320;&#24819;&#25913;&#21464;&#36825;&#20010;&#25968;&#37327;&#65292;&#21487;&#20197;&#35774;&#32622;&#20256;&#36755;&#23618;&#37197;&#32622;&#21442;&#25968;<tt class="literal">nio-remoting-threads</tt>&#12290;
            &#21442;&#35265;<a href="configuring-transports.html" title="Chapter&nbsp;16.&nbsp;&#20256;&#36755;&#23618;&#30340;&#37197;&#32622;">Chapter&nbsp;16, <i>&#20256;&#36755;&#23618;&#30340;&#37197;&#32622;</i></a>&#12290;</p><p>&#21478;&#22806;&#22312;&#20854;&#23427;&#19968;&#20123;&#22320;&#26041;&#30452;&#25509;&#20351;&#29992;&#20102;&#32447;&#31243;&#65292;&#27809;&#26377;&#29992;&#32447;&#31243;&#27744;&#12290;&#25105;&#20204;&#23558;&#23545;&#36825;&#20123;&#32447;&#31243;&#20316;&#20986;&#35299;&#37322;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="server.scheduled.thread.pool"></a>41.1.1.&nbsp;&#26381;&#21153;&#22120;&#31471;&#21487;&#35745;&#21010;&#32447;&#31243;&#27744;</h3></div></div><div></div></div><p>&#26381;&#21153;&#22120;&#21487;&#35745;&#21010;&#32447;&#31243;&#27744;&#21487;&#20197;&#23450;&#26399;&#22320;&#25110;&#24310;&#36831;&#22320;&#25191;&#34892;&#25152;&#20132;&#32473;&#30340;&#20219;&#21153;&#65292;&#23427;&#29992;&#26469;&#23436;&#25104;HornetQ&#20013;&#32477;&#22823;&#37096;&#20998;&#36825;&#26679;&#30340;&#20219;&#21153;&#12290;
                  &#23427;&#20869;&#37096;&#20351;&#29992;&#30340;&#26159;&#19968;&#20010; <tt class="literal">java.util.concurrent.ScheduledThreadPoolExecutor</tt>&#23454;&#20363;&#12290;</p><p>&#26368;&#22823;&#32447;&#31243;&#25968;&#21487;&#20197;&#22312;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#36827;&#34892;&#37197;&#32622;&#65292;&#21442;&#25968;&#21517;&#26159;<tt class="literal">scheduled-thread-pool-max-size</tt>&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">5</tt>&#12290;
                    &#36890;&#24120;&#36825;&#20010;&#32447;&#31243;&#27744;&#19981;&#38656;&#35201;&#24456;&#22823;&#25968;&#37327;&#30340;&#32447;&#31243;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10354"></a>41.1.2.&nbsp;&#26381;&#21153;&#22120;&#36890;&#29992;&#32447;&#31243;&#27744;</h3></div></div><div></div></div><p>&#26381;&#21153;&#22120;&#31471;&#32477;&#22823;&#37096;&#20998;&#30340;&#24322;&#27493;&#25805;&#20316;&#37117;&#26159;&#30001;&#36825;&#20010;&#32447;&#31243;&#27744;&#26469;&#23436;&#25104;&#30340;&#12290;&#22312;&#23427;&#30340;&#20869;&#37096;&#20351;&#29992;&#20102;&#19968;&#20010;<tt class="literal">java.util.concurrent.ThreadPoolExecutor</tt>&#30340;&#23454;&#20363;&#12290;</p><p>&#36825;&#20010;&#32447;&#31243;&#27744;&#30340;&#26368;&#22823;&#32447;&#31243;&#25968;&#22312;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#37197;&#32622;&#65292;&#30456;&#24212;&#30340;&#21442;&#25968;&#21517;&#20026;<tt class="literal">thread-pool-max-size</tt>&#12290;</p><p>&#22914;&#26524;&#23558;&#21442;&#25968;&#35774;&#20026;<tt class="literal">-1</tt>&#21017;&#34920;&#31034;&#35813;&#32447;&#31243;&#27744;&#27809;&#26377;&#32447;&#31243;&#38480;&#21046;&#12290;&#20063;&#23601;&#26159;&#35828;&#24403;&#32447;&#31243;&#19981;&#22815;&#29992;&#26102;&#65292;&#32447;&#31243;&#27744;&#23601;
                &#20250;&#21019;&#24314;&#26032;&#30340;&#32447;&#31243;&#12290;&#24403;&#20219;&#21153;&#19981;&#22810;&#26102;&#65292;&#31354;&#38386;&#30340;&#32447;&#31243;&#23558;&#20250;&#36229;&#26102;&#24182;&#34987;&#20851;&#38381;&#12290;</p><p>&#22914;&#26524;&#36825;&#20010;&#21442;&#25968;&#30340;&#20540;&#26159;&#19968;&#20010;&#22823;&#20110;&#38646;&#30340;&#25972;&#25968;<tt class="literal">n</tt>&#65292;&#21017;&#35813;&#32447;&#31243;&#27744;&#30340;&#32447;&#31243;&#25968;&#26159;&#26377;&#38480;&#30340;&#12290;&#24403;&#25152;&#26377;&#32447;&#31243;&#37117;
                &#22788;&#20110;&#24537;&#30340;&#29366;&#24577;&#24182;&#19988;&#32447;&#31243;&#25968;&#24050;&#32463;&#36798;&#21040;n&#26102;&#65292;&#20219;&#20309;&#26032;&#30340;&#35831;&#27714;&#37117;&#23558;&#34987;&#38459;&#22622;&#30452;&#21040;&#26377;&#32447;&#31243;&#31354;&#38386;&#20026;&#27490;&#12290;&#22312;&#35774;&#32622;&#32447;&#31243;&#19978;&#38480;&#26102;&#65292;&#25105;&#20204;&#24314;&#35758;
                &#35201;&#38750;&#24120;&#35880;&#24910;&#12290;&#22240;&#20026;&#22914;&#20309;&#32447;&#31243;&#25968;&#37327;&#36807;&#20302;&#20250;&#36896;&#25104;&#27515;&#38145;&#24773;&#20917;&#30340;&#21457;&#29983;&#12290;</p><p><tt class="literal">thread-pool-max-size</tt>&#30340;&#40664;&#35748;&#20540;&#26159;<tt class="literal">30</tt>&#12290;</p><p>&#21442;&#35265;<a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ThreadPoolExecutor.html" target="_top">J2SE javadoc</a>&#26377;&#20851;&#26080;&#36793;&#30028;&#65288;&#32531;&#23384;&#65289;&#21644;&#26377;&#36793;&#30028;&#65288;&#22266;&#23450;&#65289;&#32447;&#31243;&#27744;&#30340;&#35299;&#37322;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10392"></a>41.1.3.&nbsp;&#36807;&#26399;&#22238;&#25910;&#32447;&#31243;</h3></div></div><div></div></div><p>HornetQ&#20351;&#29992;&#19968;&#20010;&#21333;&#29420;&#30340;&#32447;&#31243;&#26469;&#25195;&#25551;&#38431;&#21015;&#20013;&#36807;&#26399;&#30340;&#28040;&#24687;&#12290;&#30001;&#20110;&#36825;&#20010;&#32447;&#31243;&#38656;&#35201;&#33258;&#24049;&#30340;&#20248;&#20808;&#32423;&#37197;&#32622;&#65292;&#25152;&#20197;&#19981;&#33021;&#20351;&#29992;&#19978;&#36848;&#30340;
                &#20219;&#20309;&#19968;&#20010;&#32447;&#31243;&#27744;&#12290;</p><p>&#20851;&#20110;&#22238;&#25910;&#32447;&#31243;&#30340;&#37197;&#32622;&#35831;&#21442;&#38405;<a href="message-expiry.html" title="Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;">Chapter&nbsp;22, <i>&#36807;&#26399;&#30340;&#28040;&#24687;</i></a>&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10401"></a>41.1.4.&nbsp;&#24322;&#27493;IO</h3></div></div><div></div></div><p>HornetQ&#20351;&#29992;&#19968;&#20010;&#32447;&#31243;&#27744;&#26469;&#36827;&#34892;&#24322;&#27493;IO&#30340;&#25805;&#20316;&#65292;&#21253;&#25324;&#20107;&#20214;&#30340;&#25509;&#25910;&#21644;&#21457;&#36865;&#12290;&#36825;&#20123;&#32447;&#31243;&#30340;&#21517;&#23383;&#37117;&#26159;&#20197;
                HornetQ-AIO-poller-pool&#20026;&#24320;&#22836;&#12290;&#27599;&#20010;&#25171;&#24320;&#30340;&#26085;&#24535;&#25991;&#20214;&#37117;&#23545;&#24212;&#26377;&#19968;&#20010;&#32447;&#31243;&#20026;&#20854;&#26381;&#21153;&#65288;&#36890;&#24120;&#21482;&#26377;
                &#19968;&#20010;&#65289;&#12290;</p><p>&#36824;&#26377;&#19968;&#20010;&#21333;&#29420;&#30340;&#32447;&#31243;&#29992;&#20110;&#21521;libaio&#21457;&#36865;&#20889;&#35831;&#27714;&#12290;&#36825;&#26679;&#20570;&#26159;&#20026;&#20102;&#36991;&#20813;&#19978;&#19979;&#25991;&#36716;&#25442;&#24102;&#26469;&#30340;&#24615;&#33021;&#19979;&#38477;&#12290;&#35813;
                &#32447;&#31243;&#30340;&#21517;&#23383;&#20197;HornetQ-AIO-writer-pool&#24320;&#22836;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="thread-pooling.client.side"></a>41.2.&nbsp;&#23458;&#25143;&#31471;&#32447;&#31243;&#31649;&#29702;</h2></div></div><div></div></div><p>&#22312;&#23458;&#25143;&#31471;HornetQ&#26377;&#19968;&#20010;&#38745;&#24577;&#30340;&#21487;&#35745;&#21010;&#32447;&#31243;&#27744;&#21644;&#19968;&#20010;&#38745;&#24577;&#30340;&#36890;&#29992;&#32447;&#31243;&#27744;&#65292;&#23427;&#20204;&#22312;&#19968;&#20010;JVM&#20013;&#30001;&#21516;&#19968;&#20010;classloader&#35013;&#36733;&#30340;&#25152;&#26377;&#23458;&#25143;&#31471;
            &#20849;&#21516;&#20351;&#29992;&#12290;</p><p>&#38745;&#24577;&#30340;&#21487;&#35745;&#21010;&#30340;&#32447;&#31243;&#27744;&#30340;&#26368;&#22823;&#32447;&#31243;&#25968;&#20026; <tt class="literal">5</tt>&#65292;&#36890;&#29992;&#32447;&#31243;&#27744;&#21017;&#27809;&#26377;&#32447;&#31243;&#25968;&#38480;&#21046;&#12290;</p><p>&#22914;&#26524;&#38656;&#35201;&#36824;&#21487;&#20197;&#37197;&#32622;&#19968;&#20010;<tt class="literal">ClientSessionFactory</tt>&#23454;&#20363;&#20197;&#20351;&#23427;&#25317;&#26377;&#33258;&#24049;&#30340;&#21487;&#35745;&#21010;&#19982;&#36890;&#29992;&#32447;&#31243;&#27744;&#12290;&#36890;&#36807;&#36825;&#20010;&#24037;&#21378;&#21019;&#24314;&#30340;&#20250;&#35805;&#37117;
            &#23558;&#20351;&#29992;&#36825;&#20123;&#32447;&#31243;&#27744;&#12290;</p><p>&#35201;&#24819;&#37197;&#32622;<tt class="literal">ClientSessionFactory</tt>&#20351;&#29992;&#33258;&#24049;&#30340;&#32447;&#31243;&#27744;&#65292;&#21482;&#35201;&#35843;&#29992;&#23427;&#30456;&#24212;&#30340;&#26041;&#27861;&#21462;&#20986;&#21487;&#65292;&#22914;&#65306;</p><pre class="programlisting">ClientSessionFactory myFactory = HornetQClient.createClientSessionFactory(...);
myFactory.setUseGlobalPools(false);
myFactory.setScheduledThreadPoolMaxSize(10);
myFactory.setThreadPoolMaxSize(-1);   </pre><p>&#22914;&#26524;&#20351;&#29992;JMS&#65292;&#20320;&#21487;&#20197;&#20808;&#29992;&#21516;&#26679;&#30340;&#21442;&#25968;&#35774;&#32622;ClientSessionFactory&#65292;&#28982;&#21518;&#20877;&#29992;&#36825;&#26679;&#24037;&#21378;&#21019;&#24314;<tt class="literal">ConnectionFactory</tt>&#30340;&#23454;&#20363;&#12290;&#22914;&#65306;</p><pre class="programlisting">ConnectionFactory myConnectionFactory = HornetQJMSClient.createConnectionFactory(myFactory);     </pre><p>&#22914;&#26524;&#20320;&#20351;&#29992;JNDI&#26469;&#21019;&#24314;<tt class="literal">HornetQConnectionFactory</tt>
            &#23454;&#20363;&#65292;&#20320;&#36824;&#21487;&#20197;&#22312;<tt class="literal">hornetq-jms.xml</tt>&#25991;&#20214;&#20013;&#36827;&#34892;&#37197;&#32622;&#12290;&#22914;&#65306;</p><pre class="programlisting">&lt;connection-factory name="ConnectionFactory"&gt;
    &lt;connectors&gt;
       &lt;connector-ref connector-name="netty"/&gt;
    &lt;/connectors&gt;
    &lt;entries&gt;
        &lt;entry name="ConnectionFactory"/&gt;
        &lt;entry name="XAConnectionFactory"/&gt;
    &lt;/entries&gt;
    &lt;use-global-pools&gt;false&lt;/use-global-pools&gt;
    &lt;scheduled-thread-pool-max-size&gt;10&lt;/scheduled-thread-pool-max-size&gt;
    &lt;thread-pool-max-size&gt;-1&lt;/thread-pool-max-size&gt;
&lt;/connection-factory&gt;</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libaio.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="logging.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;40.&nbsp;Libaio&#24179;&#21488;&#19987;&#26377;&#24211;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;42.&nbsp;&#26085;&#24535;&#65288;Logging&#65289;</td></tr></table></div></body></html>