<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;19.&nbsp;&#27969;&#25511;&#21046;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="transaction-config.html" title="Chapter&nbsp;18.&nbsp;&#37197;&#32622;&#36164;&#28304;&#31649;&#29702;&#22120;&#65288;Resource Manager&#65289;"><link rel="next" href="send-guarantees.html" title="Chapter&nbsp;20.&nbsp;&#21457;&#36865;&#19982;&#25552;&#20132;&#30340;&#20445;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;19.&nbsp;&#27969;&#25511;&#21046;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="transaction-config.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="send-guarantees.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="flow-control"></a>Chapter&nbsp;19.&nbsp;&#27969;&#25511;&#21046;</h2></div></div><div></div></div><p>&#27969;&#25511;&#21046;&#26159;&#25351;&#23545;&#23458;&#25143;&#31471;&#19982;&#26381;&#21153;&#22120;&#20043;&#38388;&#65292;&#25110;&#32773;&#26381;&#21153;&#22120;&#20043;&#38388;&#30340;&#25968;&#25454;&#27969;&#37327;&#36827;&#34892;&#38480;&#21046;&#65292;&#30446;&#30340;&#26159;&#38450;&#27490;&#36890;&#36805;&#21452;&#26041;&#30001;&#20110;&#22823;&#37327;&#25968;&#25454;&#32780;&#36807;&#36733;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3375"></a>19.1.&nbsp;&#25509;&#25910;&#32773;&#65288;consumer&#65289;&#27969;&#25511;&#21046;</h2></div></div><div></div></div><p>&#36825;&#26159;&#25351;&#23545;&#23458;&#25143;&#31471;&#30340;&#25509;&#25910;&#32773;&#25509;&#25910;&#28040;&#24687;&#27969;&#30340;&#25511;&#21046;&#12290;&#36890;&#24120;&#20026;&#20102;&#25552;&#39640;&#25928;&#29575;&#65292;&#22312;&#23458;&#25143;&#31471;&#36890;&#24120;&#23558;&#28040;&#24687;&#25918;&#20837;&#32531;&#23384;&#65292;&#28982;&#21518;&#20877;&#23558;&#32531;&#23384;&#20013;
         &#30340;&#28040;&#24687;&#20256;&#36882;&#32473;&#25509;&#25910;&#32773;&#65288;consumer&#65289;&#12290;&#24403;&#25509;&#25910;&#32773;&#22788;&#29702;&#28040;&#24687;&#30340;&#36895;&#24230;&#23567;&#20110;&#26381;&#21153;&#22120;&#21521;&#20854;&#21457;&#36865;&#28040;&#24687;&#30340;&#36895;&#24230;&#26102;&#65292;&#23601;&#21487;&#33021;&#36896;&#25104;&#28040;&#24687;&#22312;
         &#23458;&#25143;&#31471;&#19981;&#26029;&#31215;&#32047;&#65292;&#26368;&#32066;&#24341;&#36215;&#20869;&#23384;&#28322;&#20986;&#30340;&#38169;&#35823;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-control.consumer.window"></a>19.1.1.&nbsp;&#22522;&#20110;&#31383;&#21475;&#30340;&#27969;&#25511;&#21046;</h3></div></div><div></div></div><p>&#40664;&#35748;&#24773;&#20917;&#19979;HornetQ&#30340;&#25509;&#25910;&#32773;&#19968;&#31471;&#20250;&#23558;&#28040;&#24687;&#36827;&#34892;&#32531;&#23384;&#20197;&#25552;&#39640;&#24615;&#33021;&#12290;&#22914;&#26524;&#19981;&#36825;&#26679;&#20570;&#65292;&#37027;&#27599;&#27425;&#25509;&#25910;&#32773;&#25910;&#21040;&#19968;&#20010;&#28040;&#24687;&#65292;
            &#37117;&#24471;&#36890;&#30693;&#26381;&#21153;&#22120;&#20256;&#36882;&#19979;&#19968;&#20010;&#28040;&#24687;&#65292;&#28982;&#21518;&#26381;&#21153;&#22120;&#20877;&#23558;&#19979;&#19968;&#20010;&#28040;&#24687;&#20256;&#36882;&#36807;&#26469;&#12290;&#36825;&#23601;&#22686;&#21152;&#20102;&#36890;&#20449;&#30340;&#27425;&#25968;&#12290;</p><p>&#23545;&#20110;&#27599;&#19968;&#27425;&#28040;&#24687;&#20256;&#36882;&#37117;&#26377;&#19968;&#20010;&#32593;&#32476;&#30340;&#24448;&#36820;&#36890;&#20449;&#65292;&#36825;&#26679;&#38477;&#20302;&#20102;&#24615;&#33021;&#12290;</p><p>&#20026;&#20102;&#36991;&#20813;&#36825;&#26679;&#65292;HornetQ&#23558;&#27599;&#20010;&#25509;&#25910;&#32773;&#30340;&#28040;&#24687;&#25552;&#21069;&#25509;&#25910;&#21040;&#19968;&#22788;&#32531;&#23384;&#20013;&#12290;&#27599;&#20010;&#32531;&#23384;&#30340;&#26368;&#22823;&#20540;&#30001;
            <tt class="literal">consumer-window-size</tt>&#21442;&#25968;&#20915;&#23450;&#65288;&#21333;&#20301;&#23383;&#33410;&#65289;&#12290;</p><p><tt class="literal">consumer-window-size</tt>&#30340;&#40664;&#35748;&#20540;&#26159; 1 MiB &#65288;1024 * 1024
            &#23383;&#33410;&#65289;&#12290;</p><p>&#23427;&#30340;&#20540;&#21487;&#20197;&#26159;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">-1</tt> &#20195;&#34920;<span class="emphasis"><em>&#22823;&#23567;&#26080;&#38480;&#21046;</em></span>&#30340;&#32531;&#23384;&#12290;</p></li><li><p><tt class="literal">0</tt> &#20195;&#34920;&#19981;&#32531;&#23384;&#28040;&#24687;&#12290;&#21442;&#35265;&#30456;&#20851;&#30340;&#20363;&#23376; <a href="examples.html#examples.no-consumer-buffering" title="11.1.32.&nbsp;&#38646;&#25509;&#25910;&#32531;&#20914;">Section&nbsp;11.1.32, &#8220;&#38646;&#25509;&#25910;&#32531;&#20914;&#8221;</a>&#12290;</p></li><li><p><tt class="literal">&gt;0</tt> &#20195;&#34920;&#32531;&#23384;&#30340;&#26368;&#22823;&#23383;&#33410;&#25968;&#12290;</p></li></ul></div><p>&#21512;&#29702;&#35774;&#32622;&#25509;&#25910;&#32773;&#30340;&#31383;&#21475;&#22823;&#23567;&#21487;&#20197;&#26174;&#33879;&#25552;&#39640;&#24615;&#33021;&#12290;&#19979;&#38754;&#26159;&#20004;&#20010;&#26497;&#31471;&#30340;&#20363;&#23376;&#65306;</p><div class="variablelist"><dl><dt><span class="term">&#24555;&#36895;&#25509;&#25910;&#32773;</span></dt><dd><p>&#25152;&#35859;&#24555;&#36895;&#25509;&#25910;&#32773;&#26159;&#25351;&#28040;&#24687;&#30340;&#25509;&#25910;&#32773;&#22788;&#29702;&#28040;&#24687;&#30340;&#36895;&#24230;&#22823;&#20110;&#31561;&#20110;&#23427;&#30340;&#25509;&#25910;&#36895;&#24230;&#12290;</p><p>&#23545;&#20110;&#24555;&#36895;&#25509;&#25910;&#32773;&#25110;&#20197;&#23558;<tt class="literal">consumer-window-size</tt>&#35774;&#20026;
                     -1&#65292;&#20351;&#24471;&#23458;&#25143;&#31471;&#30340;&#28040;&#24687;&#32531;&#23384;&#30340;&#22823;&#23567; <span class="emphasis"><em>&#26080;&#38480;&#21046;</em></span>&#12290;</p><p>&#35831;&#35880;&#24910;&#20351;&#29992;&#36825;&#19968;&#35774;&#32622;&#20540;&#65306; &#22914;&#26524;&#25509;&#25910;&#32773;&#30340;&#28040;&#24687;&#22788;&#29702;&#36895;&#24230;&#27604;&#25509;&#25910;&#36895;&#24230;&#23567;&#65292;&#21487;&#36896;&#25104;&#23458;&#25143;&#31471;&#20869;&#23384;&#28322;&#20986;&#12290;</p></dd><dt><span class="term">&#24930;&#25509;&#25910;&#32773;</span></dt><dd><p>&#25152;&#35859;&#24930;&#25509;&#25910;&#32773;&#26159;&#25351;&#25509;&#25910;&#32773;&#27599;&#22788;&#29702;&#19968;&#20010;&#28040;&#24687;&#23601;&#35201;&#33457;&#24456;&#22810;&#26102;&#38388;&#12290;&#36825;&#26679;&#23558;&#32531;&#23384;&#20851;&#38381;&#23601;&#27604;&#36739;&#21512;&#29702;&#12290;&#26381;&#21153;&#22120;&#21487;&#20197;&#23558;&#22810;&#20313;&#30340;
                     &#28040;&#24687;&#20256;&#36882;&#32473;&#20854;&#23427;&#30340;&#25509;&#25910;&#32773;&#12290;</p><p>&#20551;&#35774;&#19968;&#20010;&#38431;&#21015;&#26377;2&#20010;&#25509;&#25910;&#32773;&#12290;&#20854;&#20013;&#19968;&#20010;&#25509;&#25910;&#32773;&#38750;&#24120;&#24930;&#12290;&#28040;&#24687;&#34987;&#36718;&#27969;&#20256;&#36882;&#21040;&#20004;&#20010;&#25509;&#25910;&#32773;&#12290;&#20854;&#20013;&#30340;&#24555;&#36895;&#25509;&#25910;&#32773;
                     &#24456;&#24555;&#23558;&#20854;&#32531;&#23384;&#20013;&#30340;&#28040;&#24687;&#22788;&#29702;&#23436;&#27605;&#12290;&#21516;&#26102;&#24930;&#25509;&#25910;&#32773;&#30340;&#32531;&#23384;&#20013;&#36824;&#26377;&#19968;&#20123;&#28040;&#24687;&#31561;&#24453;&#22788;&#29702;&#12290;&#36825;&#26679;&#24555;&#36895;&#25509;&#25910;&#32773;&#22312;&#19968;&#27573;&#26102;&#38388;
                     &#20869;&#23601;&#22788;&#20110;&#31354;&#38386;&#29366;&#24577;&#12290;</p><p>&#36825;&#26102;&#65292;&#23558;<tt class="literal">consumer-window-size</tt> &#35774;&#20026;0 &#65288;&#27809;&#26377;&#32531;&#23384;&#65289;&#65292;&#23601;&#21487;&#20197;&#23558;&#23427;&#21464;&#25104;
                     &#24930;&#25509;&#25910;&#32773;&#12290;&#36825;&#26679;&#22312;&#24930;&#25509;&#25910;&#32773;&#19968;&#26041;&#19981;&#20250;&#32531;&#23384;&#28040;&#24687;&#65292;&#36825;&#20351;&#24471;&#24555;&#30340;&#25509;&#25910;&#32773;&#21487;&#20197;&#22788;&#29702;&#26356;&#22810;&#30340;&#28040;&#24687;&#65292;&#32780;&#19981;&#33267;&#20110;&#22788;&#20110;&#31354;&#38386;
                     &#29366;&#24577;&#12290;</p><p>&#36825;&#35828;&#26126;&#23558;&#23427;&#35774;&#32622;&#20026;0&#21487;&#20197;&#25511;&#21046;&#19968;&#20010;&#38431;&#21015;&#30340;&#28040;&#24687;&#22312;&#22810;&#20010;&#25509;&#25910;&#32773;&#20043;&#38388;&#30340;&#28040;&#24687;&#20998;&#37197;&#12290;</p></dd></dl></div><p>&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#24456;&#38590;&#21028;&#26029;&#21738;&#20123;&#25509;&#25910;&#32773;&#26159;&#24555;&#36895;&#30340;&#65292;&#21738;&#20123;&#26159;&#24930;&#36895;&#30340;&#12290;&#24448;&#24448;&#24456;&#22810;&#25509;&#25910;&#32773;&#26159;&#22788;&#20110;&#20004;&#32773;&#20043;&#38388;&#12290;&#36825;&#26679;&#23545;&#20110;
            <tt class="literal">consumer-window-size</tt>&#30340;&#20540;&#23601;&#35201;&#35270;&#20855;&#20307;&#24773;&#20917;&#32780;&#23450;&#12290;&#26377;&#26102;&#38656;&#35201;&#36827;&#34892;&#19968;&#23450;&#30340;&#27979;&#35797;
            &#26469;&#20915;&#23450;&#23427;&#30340;&#26368;&#20339;&#20540;&#12290;&#36890;&#24120;&#24773;&#20917;&#19979;&#23558;&#20854;&#35774;&#20026;1MiB&#21487;&#20197;&#28385;&#36275;&#22823;&#22810;&#25968;&#30340;&#24212;&#29992;&#24773;&#20917;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="flow-control.core.api"></a>19.1.1.1.&nbsp;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65288;Core API&#65289;&#36827;&#34892;&#27969;&#25511;&#21046;</h4></div></div><div></div></div><p>Hornet&#30340;&#26680;&#24515;&#25509;&#21475;&#20013;&#65292;<tt class="literal">ClientSessionFactory.setConsumerWindowSize()</tt>&#26041;&#27861;&#21644;&#19968;&#20123;
                  <tt class="literal">ClientSession.createConsumer()</tt>&#26041;&#27861;&#21487;&#20197;&#25511;&#21046;&#27969;&#30340;&#31383;&#21475;&#22823;&#23567;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3469"></a>19.1.1.2.&nbsp;&#20351;&#29992;JMS&#30340;&#27969;&#25511;&#21046;</h4></div></div><div></div></div><p>&#33509;&#20351;&#29992;JNDI&#26469;&#33719;&#24471;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#38656;&#35201;&#36890;&#36807;&#37197;&#32622;<tt class="literal">hornetq-jms.xml</tt>&#25991;&#20214;&#26469;&#35774;&#23450;&#31383;&#21475;&#22823;&#23567;&#65306;</p><pre class="programlisting">
&lt;connection-factory name="ConnectionFactory"&gt;
   &lt;connectors&gt;
      &lt;connector-ref connector-name="netty-connector"/&gt;
   &lt;/connectors&gt;
   &lt;entries&gt;
      &lt;entry name="ConnectionFactory"/&gt;       
   &lt;/entries&gt;
      
   &lt;!-- Set the consumer window size to 0 to have *no* buffer on the client side --&gt;
   &lt;consumer-window-size&gt;0&lt;/consumer-window-size&gt;
&lt;/connection-factory&gt;
            </pre><p>&#22914;&#26524;&#30452;&#25509;&#23454;&#20363;&#21270;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#20351;&#29992;<tt class="literal">HornetQConnectionFactory.setConsumerWindowSize()</tt>
               &#26041;&#27861;&#26469;&#35774;&#23450;&#31383;&#21475;&#22823;&#23567;&#12290;</p><p>&#21442;&#35265;&#20363;&#23376;<a href="examples.html#examples.no-consumer-buffering" title="11.1.32.&nbsp;&#38646;&#25509;&#25910;&#32531;&#20914;">Section&nbsp;11.1.32, &#8220;&#38646;&#25509;&#25910;&#32531;&#20914;&#8221;</a>&#26469;&#20102;&#35299;&#22914;&#20309;&#37197;&#32622;HornetQ&#26469;
               &#20851;&#38381;&#25509;&#25910;&#32773;&#30340;&#32531;&#23384;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3488"></a>19.1.2.&nbsp;&#36895;&#29575;&#27969;&#25511;&#21046;</h3></div></div><div></div></div><p>&#25105;&#20204;&#36824;&#21487;&#20197;&#36890;&#36807;&#25511;&#21046; <span class="emphasis"><em>&#36895;&#29575;</em></span>&#30340;&#26041;&#27861;&#26469;&#25511;&#21046;&#27969;&#12290;&#36825;&#26159;&#19968;&#31181;&#20687;&#35843;&#33410;&#33410;&#27969;&#38400;&#30340;&#24418;&#24335;&#12290;
            &#36825;&#31181;&#26041;&#27861;&#20445;&#35777;&#19968;&#20010;&#25509;&#25910;&#32773;&#25509;&#25910;&#28040;&#24687;&#30340;&#36895;&#29575;&#19981;&#20250;&#36229;&#36807;&#35774;&#23450;&#30340;&#20540;&#12290; </p><p>&#36895;&#29575;&#24517;&#39035;&#26159;&#19968;&#20010;&#27491;&#25972;&#25968;&#12290;&#23427;&#20195;&#34920;&#26368;&#22823;&#25509;&#25910;&#36895;&#24230;&#65292;&#21333;&#20301;&#26159;&#28040;&#24687;&#27599;&#31186;&#12290;&#23558;&#23427;&#35774;&#20026;<tt class="literal">-1</tt>&#23601;&#20250;&#20851;&#38381;&#36895;&#29575;&#27969;&#25511;&#21046;&#12290;
               &#40664;&#35748;&#20540;&#26159;<tt class="literal">-1</tt>&#12290;</p><p>&#21442;&#35265;&#26377;&#20851;&#36895;&#29575;&#27969;&#25511;&#21046;&#30340;&#20363;&#23376;<a href="examples.html#examples.consumer-rate-limit" title="11.1.10.&nbsp;&#38480;&#21046;&#25509;&#25910;&#36895;&#29575;">Section&nbsp;11.1.10, &#8220;&#38480;&#21046;&#25509;&#25910;&#36895;&#29575;&#8221;</a>&#20197;&#36827;&#19968;&#27493;&#20102;&#35299;&#23427;&#30340;&#24037;&#20316;&#21407;&#29702;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="flow-control.rate.core.api"></a>19.1.2.1.&nbsp;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65288;Core API&#65289;</h4></div></div><div></div></div><p>HornetQ&#30340;&#26680;&#24515;&#25509;&#21475;&#30340;<tt class="literal">ClientSessionFactory.setConsumerMaxRate(int consumerMaxRate)</tt>&#26041;&#27861;&#25110;
               &#26576;&#20123;<tt class="literal">ClientSession.createConsumer()</tt>&#26041;&#27861;&#21487;&#20197;&#23454;&#29616;&#23545;&#27969;&#30340;&#36895;&#29575;&#25511;&#21046;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3519"></a>19.1.2.2.&nbsp;&#20351;&#29992;JMS</h4></div></div><div></div></div><p>&#22914;&#26524;&#20174;JNDI&#20013;&#33719;&#21462;&#36830;&#25509;&#24037;&#21378;&#65292;&#38656;&#35201;&#36890;&#36807;&#37197;&#32622;<tt class="literal">hornetq-jms.xml</tt>&#26469;&#36827;&#34892;&#36895;&#29575;&#27969;&#25511;&#21046;&#65306;</p><pre class="programlisting">&lt;connection-factory name="ConnectionFactory"&gt;
      &lt;connectors&gt;
         &lt;connector-ref connector-name="netty-connector"/&gt;
      &lt;/connectors&gt;
      &lt;entries&gt;
         &lt;entry name="ConnectionFactory"/&gt;       
      &lt;/entries&gt;
      &lt;!-- We limit consumers created on this connection factory to consume messages
             at a maximum rate
      of 10 messages per sec --&gt;
      &lt;consumer-max-rate&gt;10&lt;/consumer-max-rate&gt;
 &lt;/connection-factory&gt;</pre><p>&#22914;&#26524;&#26159;&#30452;&#25509;&#23454;&#20363;&#21270;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#36890;&#36807;<tt class="literal">HornetQConnectionFactory.setConsumerMaxRate(int
                  consumerMaxRate)</tt>&#26041;&#27861;&#26469;&#35774;&#23450;&#26368;&#22823;&#27969;&#36895;&#29575;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>&#36895;&#29575;&#27969;&#25511;&#21046;&#21487;&#20197;&#19982;&#31383;&#21475;&#27969;&#25511;&#21046;&#32467;&#21512;&#20351;&#29992;&#12290;&#36895;&#29575;&#25511;&#21046;&#21482;&#35268;&#23450;&#20102;&#23458;&#25143;&#31471;&#27599;&#31186;&#25509;&#25910;&#22810;&#23569;&#28040;&#24687;&#12290;&#22240;&#27492;&#22914;&#26524;&#20320;&#35774;&#23450;
                  &#20102;&#19968;&#20010;&#36739;&#20302;&#30340;&#36895;&#29575;&#65292;&#21516;&#26102;&#21448;&#35774;&#23450;&#20102;&#19968;&#20010;&#22823;&#30340;&#32531;&#23384;&#31383;&#21475;&#65292;&#37027;&#20040;&#23458;&#25143;&#31471;&#30340;&#32531;&#23384;&#23558;&#20250;&#24456;&#24555;&#39281;&#21644;&#12290;</p></div><p>&#21442;&#35265;&#25509;&#25910;&#36895;&#29575;&#27969;&#25511;&#21046;&#30340;&#20363;&#23376;<a href="examples.html#examples.consumer-rate-limit" title="11.1.10.&nbsp;&#38480;&#21046;&#25509;&#25910;&#36895;&#29575;">Section&nbsp;11.1.10, &#8220;&#38480;&#21046;&#25509;&#25910;&#36895;&#29575;&#8221;</a>&#36827;&#19968;&#27493;&#20102;&#35299;&#36895;&#29575;&#27969;&#25511;&#21046;&#30340;&#37197;&#32622;&#21644;&#20351;&#29992;&#12290;</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3541"></a>19.2.&nbsp;&#21457;&#36865;&#32773;&#65288;producer&#65289;&#30340;&#27969;&#25511;&#21046;</h2></div></div><div></div></div><p>HornetQ&#36824;&#21487;&#20197;&#25511;&#21046;&#23458;&#25143;&#31471;&#21521;&#26381;&#21153;&#22120;&#21457;&#36865;&#28040;&#24687;&#30340;&#36895;&#24230;&#65292;&#20197;&#36991;&#20813;&#26381;&#21153;&#22120;&#22240;&#22823;&#37327;&#25968;&#25454;&#36807;&#36733;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3546"></a>19.2.1.&nbsp;&#22522;&#20110;&#31383;&#21475;&#30340;&#27969;&#25511;&#21046;</h3></div></div><div></div></div><p>&#19982;&#25509;&#25910;&#32773;&#30340;&#30456;&#24212;&#30340;&#25511;&#21046;&#30456;&#20284;&#12290;&#22312;&#40664;&#35748;&#26465;&#20214;&#19979;&#65292;&#21457;&#36865;&#32773;&#35201;&#26377;&#36275;&#22815;&#30340;&#20221;&#39069;&#65288;credits&#65289;&#25165;&#21487;&#20197;&#21521;&#26381;&#21153;&#22120;&#30340;&#22320;&#22336;&#21457;&#36865;&#28040;&#24687;&#12290;
               &#36825;&#20010;&#20221;&#39069;&#23601;&#26159;&#28040;&#24687;&#30340;&#22823;&#23567;&#12290;</p><p>&#24403;&#21457;&#36865;&#32773;&#30340;&#20221;&#39069;&#19981;&#36275;&#26102;&#65292;&#23427;&#35201;&#21521;&#26381;&#21153;&#22120;&#35831;&#27714;&#26356;&#22810;&#30340;&#20221;&#39069;&#20197;&#20415;&#21457;&#36865;&#26356;&#22810;&#30340;&#28040;&#24687;&#12290;</p><p>&#21457;&#36865;&#32773;&#19968;&#27425;&#21521;&#26381;&#21153;&#22120;&#35831;&#27714;&#30340;&#20221;&#39069;&#20540;&#34987;&#31216;&#20026;<span class="italic">&#31383;&#21475;&#22823;&#23567;</span>&#12290;</p><p>&#20110;&#26159;&#31383;&#21475;&#22823;&#23567;&#23601;&#26159;&#25351;&#21457;&#36865;&#32773;&#21521;&#26381;&#21153;&#22120;&#19981;&#38388;&#26029;&#21457;&#36865;&#28040;&#24687;&#30340;&#24635;&#26368;&#22823;&#23383;&#33410;&#25968;&#12290;&#24403;&#21457;&#36865;&#23436;&#27605;&#26102;&#38656;&#20877;&#21521;&#26381;&#21153;&#22120;&#35831;&#27714;&#20221;&#39069;&#12290;&#36825;&#26679;&#23601;&#36991;&#20813;&#20102;
            &#26381;&#21153;&#22120;&#28040;&#24687;&#36807;&#36733;&#30340;&#24773;&#20917;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3560"></a>19.2.1.1.&nbsp;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65288;Core API&#65289;</h4></div></div><div></div></div><p>&#33509;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65292;<tt class="literal">ClientSessionFactory.setProducerWindowSize(int producerWindowSize)</tt>
               &#26041;&#27861;&#21487;&#20197;&#23545;&#31383;&#21475;&#22823;&#23567;&#36827;&#34892;&#35774;&#23450;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3568"></a>19.2.1.2.&nbsp;&#20351;&#29992;JMS</h4></div></div><div></div></div><p>&#22914;&#26524;&#20351;&#29992;JNDI&#26469;&#33719;&#24471;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#38656;&#35201;&#37197;&#32622;<tt class="literal">hornetq-jms.xml</tt>&#25991;&#20214;&#20197;&#35774;&#23450;&#31383;&#21475;&#22823;&#23567;&#65306;</p><pre class="programlisting">
               &lt;connection-factory name="ConnectionFactory"&gt;
                  &lt;connectors&gt;
                     &lt;connector-ref connector-name="netty-connector"/&gt;
                  &lt;/connectors&gt;
                  &lt;entries&gt;
                     &lt;entry name="ConnectionFactory"/&gt;       
                  &lt;/entries&gt;
                  &lt;producer-window-size&gt;10&lt;/producer-window-size&gt;
               &lt;/connection-factory&gt;</pre><p>&#22914;&#26524;&#26159;&#30452;&#25509;&#23454;&#20363;&#21270;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#20351;&#29992;<tt class="literal">HornetQConnectionFactory.setProducerWindowSize(int
                  producerWindowSize)</tt>&#26041;&#27861;&#26469;&#35774;&#23450;&#31383;&#21475;&#22823;&#23567;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3583"></a>19.2.1.3.&nbsp;&#38480;&#23450;&#21457;&#36865;&#32773;&#31383;&#21475;&#27969;&#25511;&#21046;</h4></div></div><div></div></div><p>&#36890;&#24120;&#24773;&#20917;&#19979;&#23458;&#25143;&#31471;&#35831;&#27714;&#22810;&#23569;&#20221;&#39069;&#65292;HornetQ&#26381;&#21153;&#22120;&#23601;&#32473;&#20104;&#22810;&#23569;&#20221;&#39069;&#12290;&#28982;&#32780;&#25105;&#20204;&#36824;&#21487;&#20197;&#38024;&#23545;&#27599;&#20010;&#22320;&#22336;&#26469;&#35774;&#23450;&#19968;&#20010;&#26368;&#22823;
               &#30340;&#20221;&#39069;&#20540;&#65292;&#20197;&#20351;&#26381;&#21153;&#22120;&#32473;&#20986;&#30340;&#20221;&#39069;&#37117;&#19981;&#22823;&#20110;&#35813;&#20540;&#12290;&#36825;&#26679;&#21487;&#20197;&#38450;&#27490;&#19968;&#20010;&#22320;&#22336;&#30340;&#20869;&#23384;&#28322;&#20986;&#12290;</p><p>&#20363;&#22914;&#65292;&#22914;&#26524;&#26377;&#19968;&#20010;&#38431;&#21015;&#31216;&#20026;&#8220;myqueue&#8221;&#12290;&#23558;&#23427;&#30340;&#26368;&#22823;&#20869;&#23384;&#20540;&#35774;&#20026;10MiB&#65292;&#21017;&#26381;&#21153;&#22120;&#23601;&#20250;&#25511;&#21046;&#32473;&#20986;&#30340;&#20221;&#39069;&#20197;&#20445;&#35777;&#21521;&#35813;&#38431;&#21015;&#30340;&#22320;
               &#22336;&#21457;&#36865;&#28040;&#24687;&#26102;&#19981;&#20250;&#21344;&#22823;&#20110;10MiB&#30340;&#20869;&#23384;&#31354;&#38388;&#12290;</p><p>&#24403;&#19968;&#30456;&#22320;&#22336;&#24050;&#32463;&#28385;&#20102;&#30340;&#26102;&#20505;&#65292;&#21457;&#36865;&#32773;&#23558;&#20250;&#38459;&#22622;&#30452;&#21040;&#35813;&#22320;&#22336;&#26377;&#20102;&#22810;&#20313;&#30340;&#31354;&#38388;&#20026;&#27490;&#65292;&#21363;&#22320;&#22336;&#20013;&#30340;&#28040;&#24687;&#34987;&#25509;&#25910;&#20102;&#19968;&#37096;&#20998;&#21518;&#20351;&#24471;
               &#22320;&#22336;&#33150;&#20986;&#20102;&#19968;&#20123;&#31354;&#38388;&#12290;</p><p>&#25105;&#20204;&#23558;&#36825;&#31181;&#25511;&#21046;&#26041;&#27861;&#31216;&#20026;&#38480;&#23450;&#21457;&#36865;&#32773;&#31383;&#21475;&#27969;&#25511;&#21046;&#12290;&#36825;&#26159;&#19968;&#31181;&#26377;&#25928;&#30340;&#38450;&#27490;&#26381;&#21153;&#22120;&#20869;&#23384;&#28322;&#20986;&#30340;&#25163;&#27573;&#12290;</p><p>&#23427;&#21487;&#20197;&#30475;&#25104;&#26159;&#20998;&#39029;&#36716;&#23384;&#65288;paging&#65289;&#30340;&#21478;&#19968;&#31181;&#26041;&#27861;&#12290;&#20998;&#39029;&#36716;&#23384;&#19981;&#38459;&#22622;&#21457;&#36865;&#32773;&#65292;&#23427;&#23558;&#28040;&#24687;&#36716;&#23384;&#21040;&#23384;&#36142;&#20171;&#36136;&#19978;&#20197;&#33410;&#30465;&#20869;&#23384;&#30340;&#31354;&#38388;&#12290;</p><p>&#35201;&#37197;&#32622;&#19968;&#20010;&#22320;&#22336;&#30340;&#26368;&#22823;&#23481;&#37327;&#24182;&#21578;&#35785;&#26381;&#21153;&#22120;&#22312;&#22320;&#22336;&#28385;&#20102;&#30340;&#24773;&#20917;&#19979;&#38459;&#22622;&#21457;&#36865;&#32773;&#65292;&#20320;&#38656;&#35201;&#20026;&#35813;&#22320;&#22336;&#23450;&#20041;&#19968;&#20010;
               AddressSettings (<a href="queue-attributes.html#queue-attributes.address-settings" title="25.3.&nbsp;&#36890;&#36807;&#22320;&#22336;&#35774;&#32622;&#26469;&#37197;&#32622;&#38431;&#21015;&#23646;&#24615;">Section&nbsp;25.3, &#8220;&#36890;&#36807;&#22320;&#22336;&#35774;&#32622;&#26469;&#37197;&#32622;&#38431;&#21015;&#23646;&#24615;&#8221;</a>) &#24182;&#35774;&#23450;
               <tt class="literal">max-size-bytes</tt> &#21644; <tt class="literal">address-full-policy</tt>&#12290;</p><p>&#36825;&#20010;&#37197;&#32622;&#23545;&#25152;&#26377;&#27880;&#20876;&#21040;&#35813;&#22320;&#22336;&#30340;&#38431;&#21015;&#26377;&#25928;&#12290;&#21363;&#25152;&#26377;&#27880;&#20876;&#38431;&#21015;&#30340;&#24635;&#20869;&#23384;&#23558;&#19981;&#36229;&#36807; <tt class="literal">max-size-bytes</tt>&#12290;&#23545;&#20110;JMS topic&#24773;&#20917;&#21017;&#24847;&#35859;&#30528;&#35813;topic&#30340;&#25152;&#26377;&#35746;&#38405;&#30340;&#20869;&#23384;&#19981;&#33021;&#36229;&#36807;
                  max-size-bytes&#30340;&#35774;&#23450;&#20540;&#12290;</p><p>&#19979;&#38754;&#26159;&#19968;&#20010;&#20363;&#23376;&#65306;</p><pre class="programlisting">
               &lt;address-settings&gt;
                  &lt;address-setting match="jms.queue.exampleQueue"&gt;            
                     &lt;max-size-bytes&gt;100000&lt;/max-size-bytes&gt;
                     &lt;address-full-policy&gt;BLOCK&lt;/address-full-policy&gt;   
                  &lt;/address-setting&gt;
               &lt;/address-settings&gt;</pre><p>&#19978;&#38754;&#30340;&#20363;&#23376;&#23558;JMS&#38431;&#21015;"exampleQueue"&#30340;&#26368;&#22823;&#20869;&#23384;&#20540;&#35774;&#20026;
               100000 &#23383;&#33410;&#24182;&#19988;&#38459;&#22622;&#21457;&#36865;&#32773;&#20197;&#38450;&#27490;&#28040;&#24687;&#37327;&#36229;&#36807;&#36825;&#20010;&#20540;&#12290;</p><p>&#27880;&#24847;&#24517;&#39035;&#35774;&#32622; <tt class="literal">BLOCK</tt>&#30340;&#31574;&#30053;&#25165;&#33021;&#25171;&#24320;&#38480;&#23450;&#21457;&#36865;&#32773;&#31383;&#21475;&#25511;&#21046;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>&#35831;&#27880;&#24847;&#40664;&#35748;&#30340;&#37197;&#32622;&#19979;&#24403;&#19968;&#20010;&#22320;&#22336;&#20013;&#30340;&#28040;&#24687;&#37327;&#36798;&#21040;10MiB&#26102;&#65292;&#20854;&#25152;&#26377;&#30340;&#28040;&#24687;&#21457;&#36865;&#32773;&#23558;&#21464;&#20026;&#38459;&#22622;&#29366;&#24577;&#65292;&#20063;&#23601;&#26159;&#35828;
                  &#22312;&#27809;&#26377;&#25509;&#25910;&#30340;&#24773;&#20917;&#19979;&#20320;&#19981;&#33021;&#21521;&#19968;&#20010;&#22320;&#22336;&#19981;&#38459;&#22622;&#22320;&#19968;&#27425;&#21457;&#36865;&#36229;&#36807;10MiB&#30340;&#28040;&#24687;&#12290;&#35201;&#24819;&#22686;&#21152;&#36825;&#20010;&#38480;&#21046;&#65292;&#21487;&#20197;&#21152;&#22823;
                  <tt class="literal">max-size-bytes</tt>&#21442;&#25968;&#30340;&#20540;&#65292;&#25110;&#32773;&#35843;&#25972;&#22320;&#22336;&#30340;&#28040;&#24687;&#23481;&#37327;&#38480;&#21046;&#12290;</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3628"></a>19.2.2.&nbsp;&#36895;&#29575;&#27969;&#25511;&#21046;</h3></div></div><div></div></div><p>HornetQ&#20063;&#21487;&#20197;&#25511;&#21046;&#21457;&#36865;&#32773;&#21457;&#36865;&#28040;&#24687;&#30340;&#36895;&#29575;&#12290;&#21333;&#20301;&#26159;&#27599;&#31186;&#28040;&#24687;&#25968;&#12290;&#36890;&#36807;&#35774;&#23450;&#36895;&#29575;&#21487;&#20445;&#35777;&#21457;&#36865;&#32773;&#30340;&#21457;&#36865;&#36895;&#29575;&#19981;&#36229;&#36807;&#26576;&#20010;&#20540;&#12290;</p><p>&#36895;&#29575;&#24517;&#39035;&#26159;&#19968;&#20010;&#27491;&#25972;&#25968;&#12290;&#22914;&#26524;&#35774;&#20026; <tt class="literal">-1</tt> &#21017;&#20851;&#38381;&#36895;&#29575;&#27969;&#25511;&#21046;&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">-1</tt>&#12290;</p><p>&#35831;&#21442;&#35265;&#20363;&#23376;<a href="examples.html#producer-rate-limiting-example" title="11.1.36.&nbsp;&#28040;&#24687;&#21457;&#36865;&#36895;&#24230;&#38480;&#21046;">Section&nbsp;11.1.36, &#8220;&#28040;&#24687;&#21457;&#36865;&#36895;&#24230;&#38480;&#21046;&#8221;</a>&#36827;&#19968;&#27493;&#20102;&#35299;&#36895;&#29575;&#27969;&#25511;&#21046;&#30340;&#20351;&#29992;&#26041;&#27861;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="flow-control.producer.rate.core.api"></a>19.2.2.1.&nbsp;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65288;Core API&#65289;</h4></div></div><div></div></div><p>&#22914;&#26524;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65292;<tt class="literal">ClientSessionFactory.setProducerMaxRate(int consumerMaxRate)</tt>&#26041;&#27861;&#25110;
                  &#26576;&#20123; <tt class="literal">ClientSession.createProducer()</tt>&#26041;&#27861;&#21487;&#20197;&#35774;&#32622;&#26368;&#22823;&#36895;&#29575;&#20540;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3656"></a>19.2.2.2.&nbsp;&#20351;&#29992; JMS</h4></div></div><div></div></div><p>&#22914;&#26524;&#20351;&#29992;JNDI&#65292;&#38656;&#35201;&#37197;&#32622;<tt class="literal">hornetq-jms.xml</tt>&#25991;&#20214;&#65306;</p><pre class="programlisting">&lt;connection-factory name="ConnectionFactory"&gt;
      &lt;connectors&gt;
         &lt;connector-ref connector-name="netty-connector"/&gt;
      &lt;/connectors&gt;
      &lt;entries&gt;
         &lt;entry name="ConnectionFactory"/&gt;       
      &lt;/entries&gt;
      &lt;!-- We limit producers created on this connection factory to produce messages 
                at a maximum rate
      of 10 messages per sec --&gt;
      &lt;producer-max-rate&gt;10&lt;/producer-max-rate&gt;
 &lt;/connection-factory&gt;</pre><p>&#22914;&#26524;&#30452;&#25509;&#23454;&#20363;&#21270;&#36830;&#25509;&#24037;&#21378;&#65292;&#21017;&#20351;&#29992;<tt class="literal">HornetQConnectionFactory.setProducerMaxRate(int
                  consumerMaxRate)</tt>&#26041;&#27861;&#26469;&#35774;&#32622;&#12290;</p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="transaction-config.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="send-guarantees.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;18.&nbsp;&#37197;&#32622;&#36164;&#28304;&#31649;&#29702;&#22120;&#65288;Resource Manager&#65289;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;20.&nbsp;&#21457;&#36865;&#19982;&#25552;&#20132;&#30340;&#20445;&#35777;</td></tr></table></div></body></html>