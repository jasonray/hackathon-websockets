<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;37.&nbsp;&#37325;&#22797;&#28040;&#24687;&#26816;&#27979;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="core-bridges.html" title="Chapter&nbsp;36.&nbsp;&#26680;&#24515;&#26725;"><link rel="next" href="clusters.html" title="Chapter&nbsp;38.&nbsp;&#38598;&#32676;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;37.&nbsp;&#37325;&#22797;&#28040;&#24687;&#26816;&#27979;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="core-bridges.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="clusters.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="duplicate-detection"></a>Chapter&nbsp;37.&nbsp;&#37325;&#22797;&#28040;&#24687;&#26816;&#27979;</h2></div></div><div></div></div><p>HornetQ&#20855;&#26377;&#24378;&#22823;&#30340;&#33258;&#21160;&#26816;&#27979;&#37325;&#22797;&#28040;&#24687;&#30340;&#21151;&#33021;&#12290;&#24212;&#29992;&#23618;&#26080;&#38656;&#23454;&#29616;&#22797;&#26434;&#30340;&#37325;&#22797;&#26816;&#27979;&#12290;&#26412;&#31456;&#35299;&#37322;&#20102;&#20160;&#20040;&#26159;&#37325;&#22797;&#26816;&#27979;&#65292;&#23427;
        &#22312;HornetQ&#20013;&#22914;&#20309;&#24037;&#20316;&#30340;&#65292;&#20197;&#21450;&#22914;&#20309;&#36827;&#34892;&#37197;&#32622;&#12290;</p><p>&#24403;&#23458;&#25143;&#31471;&#21521;&#26381;&#21153;&#22120;&#31471;&#21457;&#36865;&#28040;&#24687;&#26102;&#65292;&#25110;&#32773;&#20174;&#19968;&#20010;&#26381;&#21153;&#22120;&#21521;&#21478;&#19968;&#20010;&#26381;&#21153;&#22120;&#20256;&#36882;&#28040;&#24687;&#26102;&#65292;&#22914;&#26524;&#28040;&#24687;&#21457;&#36865;&#21518;&#30446;&#26631;&#26381;&#21153;&#22120;&#25110;&#32773;
        &#36830;&#25509;&#20986;&#29616;&#25925;&#38556;&#65292;&#23548;&#33268;&#21457;&#36865;&#19968;&#26041;&#27809;&#26377;&#25910;&#21040;&#21457;&#36865;&#25104;&#21151;&#30340;&#30830;&#35748;&#20449;&#24687;&#65292;&#21457;&#36865;&#26041;&#22240;&#27492;&#23601;&#26080;&#27861;&#30830;&#23450;&#28040;&#24687;&#26159;&#21542;&#24050;&#32463;&#25104;&#21151;&#21457;&#36865;&#21040;&#20102;&#30446;&#26631;&#22320;
        &#22336;&#12290;</p><p>&#22914;&#26524;&#19978;&#36848;&#30340;&#25925;&#38556;&#21457;&#29983;&#22312;&#28040;&#24687;&#34987;&#25104;&#21151;&#25509;&#25910;&#24182;&#22788;&#29702;&#21518;&#65292;&#20294;&#26159;&#22312;&#21521;&#21457;&#36865;&#26041;&#36820;&#22238;&#21151;&#33021;&#30830;&#35748;&#20449;&#24687;&#20043;&#21069;&#65292;&#37027;&#20040;&#28040;&#24687;&#23454;&#38469;&#19978;&#21487;&#20197;&#21040;&#36798;
        &#20854;&#30446;&#30340;&#22320;&#22336;&#65307;&#22914;&#26524;&#25925;&#38556;&#21457;&#29983;&#22312;&#28040;&#24687;&#30340;&#25509;&#25910;&#21450;&#22788;&#29702;&#36807;&#31243;&#20013;&#65292;&#21017;&#28040;&#24687;&#19981;&#20250;&#21040;&#36798;&#20854;&#30446;&#30340;&#22320;&#22336;&#12290;&#20174;&#21457;&#36865;&#26041;&#30340;&#35282;&#24230;&#30475;&#65292;&#23427;&#26080;&#27861;&#21306;&#20998;
        &#36825;&#20004;&#31181;&#24773;&#20917;&#12290;</p><p>&#24403;&#26381;&#21153;&#22120;&#24674;&#22797;&#21518;&#65292;&#23458;&#25143;&#31471;&#38754;&#20020;&#30340;&#22256;&#38590;&#30340;&#36873;&#25321;&#12290;&#23427;&#30693;&#36947;&#26381;&#21153;&#22120;&#20986;&#20102;&#25925;&#38556;&#65292;&#20294;&#26159;&#19981;&#30693;&#36947;&#21018;&#21018;&#21457;&#36865;&#30340;&#28040;&#24687;&#26159;&#21542;&#25104;&#21151;&#21040;&#36798;&#30446;&#30340;
        &#22320;&#22336;&#12290;&#22914;&#26524;&#23427;&#37325;&#26032;&#21457;&#36865;&#36825;&#20010;&#28040;&#24687;&#65292;&#23601;&#26377;&#21487;&#33021;&#36896;&#25104;&#28040;&#24687;&#30340;&#37325;&#22797;&#12290;&#22914;&#26524;&#36825;&#20010;&#28040;&#24687;&#26159;&#19968;&#20010;&#35746;&#21333;&#30340;&#35805;&#65292;&#37325;&#22797;&#21457;&#36865;&#28040;&#24687;&#23601;&#20250;&#20135;&#29983;&#20004;
        &#20010;&#30456;&#21516;&#30340;&#35746;&#21333;&#65292;&#36825;&#24403;&#28982;&#19981;&#26159;&#25152;&#24076;&#26395;&#30340;&#32080;&#26524;&#12290;</p><p>&#23558;&#28040;&#24687;&#30340;&#21457;&#36865;&#25918;&#21040;&#19968;&#20010;&#20107;&#21153;&#20013;&#20063;&#19981;&#33021;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#12290;&#22914;&#26524;&#22312;&#20107;&#21153;&#25552;&#20132;&#30340;&#36807;&#31243;&#20013;&#21457;&#29983;&#25925;&#38556;&#65292;&#21516;&#26679;&#19981;&#33021;&#30830;&#23450;&#36825;&#20010;&#20107;&#21153;&#26159;&#21542;&#25552;&#20132;
        &#25104;&#21151;&#65281;</p><p>&#20026;&#20102;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;HornetQ&#25552;&#20379;&#20102;&#33258;&#21160;&#28040;&#24687;&#37325;&#22797;&#26816;&#27979;&#21151;&#33021;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8862"></a>37.1.&nbsp;&#22312;&#28040;&#24687;&#21457;&#36865;&#20013;&#24212;&#29992;&#37325;&#22797;&#26816;&#27979;</h2></div></div><div></div></div><p>&#22312;&#28040;&#24687;&#21457;&#36865;&#20013;&#21551;&#29992;&#37325;&#22797;&#26816;&#27979;&#21151;&#33021;&#21313;&#20998;&#31616;&#21333;&#65306;&#20320;&#21482;&#38656;&#23558;&#28040;&#24687;&#30340;&#19968;&#20010;&#29305;&#27530;&#23646;&#24615;&#35774;&#32622;&#19968;&#20010;&#21807;&#19968;&#20540;&#12290;&#20320;&#21487;&#20197;&#29992;&#20219;&#24847;&#26041;&#27861;&#26469;
            &#35745;&#31639;&#36825;&#20010;&#20540;&#65292;&#20294;&#26159;&#35201;&#20445;&#35777;&#23427;&#30340;&#21807;&#19968;&#24615;&#12290;&#24403;&#30446;&#26631;&#26381;&#21153;&#22120;&#25509;&#25910;&#21040;&#36825;&#20010;&#28040;&#24687;&#26102;&#65292;&#23427;&#20250;&#26816;&#26597;&#36825;&#20010;&#23646;&#24615;&#26159;&#21542;&#34987;&#35774;&#32622;&#65292;&#22914;&#26524;&#35774;&#32622;&#20102;&#65292;
            &#23601;&#26816;&#26597;&#20869;&#23384;&#32531;&#23384;&#20013;&#26159;&#21542;&#24050;&#32463;&#25509;&#25910;&#21040;&#20102;&#30456;&#21516;&#20540;&#30340;&#28040;&#24687;&#12290;&#22914;&#26524;&#21457;&#29616;&#24050;&#32463;&#25509;&#25910;&#36807;&#20855;&#26377;&#30456;&#21516;&#23646;&#24615;&#20540;&#30340;&#28040;&#24687;&#65292;&#23427;&#23558;&#24573;&#30053;&#36825;&#20010;&#28040;&#24687;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>&#22312;&#33410;&#28857;&#20043;&#38388;&#30340;&#28040;&#24687;&#20256;&#36882;&#20351;&#29992;&#37325;&#22797;&#28040;&#24687;&#26816;&#27979;&#21487;&#20197;&#20445;&#35777;<span class="emphasis"><em>&#19968;&#27425;&#19988;&#21482;&#19968;&#27425;</em></span>&#30340;&#20256;&#36882;&#65292;&#21644;&#20351;&#29992;
                XA&#20107;&#21153;&#25509;&#25910;&#28040;&#24687;&#30340;&#25928;&#26524;&#19968;&#26679;&#65292;&#20294;&#26159;&#27604;XA&#28040;&#32791;&#30340;&#36164;&#28304;&#35201;&#23569;&#65292;&#24182;&#19988;&#26356;&#23481;&#26131;&#12290;</p></div><p>&#22914;&#26524;&#26159;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#21457;&#36865;&#28040;&#24687;&#65292;&#21017;&#21482;&#38656;&#35201;&#35774;&#32622;&#20854;&#20013;&#19968;&#20010;&#28040;&#24687;&#30340;&#23646;&#24615;&#20540;&#12290;&#22312;&#26381;&#21153;&#22120;&#31471;&#22914;&#26524;&#26381;&#21153;&#22120;&#26816;&#27979;&#21040;&#19968;&#20010;&#20107;&#21153;&#20013;&#26576;&#19968;&#20010;
            &#28040;&#24687;&#37325;&#22797;&#65292;&#21017;&#20250;&#24573;&#30053;&#25972;&#20010;&#20107;&#21153;&#12290;</p><p>&#36825;&#20010;&#23646;&#24615;&#30340;&#21517;&#31216;&#30001;<tt class="literal">org.hornetq.api.core.HDR_DUPLICATE_DETECTION_ID</tt>&#23450;&#20041;&#65292;&#21363;&#65306;
               <tt class="literal">_HQ_DUPL_ID</tt>&#12290;</p><p>&#35813;&#23646;&#24615;&#30340;&#20540;&#21487;&#20197;&#26159;<tt class="literal">byte[]</tt>&#31867;&#22411;&#25110;<tt class="literal">SimpleString</tt>&#31867;&#22411;&#65288;&#26680;&#24515;&#25509;&#21475;&#65289;&#12290;&#22914;&#26524;&#20351;&#29992;JMS&#65292;&#23427;&#24517;&#39035;&#26159;<tt class="literal">String</tt>
            &#31867;&#22411;&#12290;&#23427;&#30340;&#20540;&#19968;&#23450;&#26159;&#21807;&#19968;&#30340;&#12290;&#19968;&#20010;&#31616;&#21333;&#30340;&#26041;&#27861;&#26159;&#20351;&#29992;UUID&#12290;</p><p>&#19979;&#38754;&#26159;&#19968;&#20010;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#35774;&#32622;&#36825;&#20010;&#23646;&#24615;&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">
...     

ClientMessage message = session.createMessage(true);

SimpleString myUniqueID = "This is my unique id";   // Could use a UUID for this

message.setStringProperty(HDR_DUPLICATE_DETECTION_ID, myUniqueID);

...
        </pre><p>&#19979;&#38754;&#21017;&#26159;&#19968;&#20010;&#20351;&#29992;JMS&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">
...     

Message jmsMessage = session.createMessage();

String myUniqueID = "This is my unique id";   // Could use a UUID for this

message.setStringProperty(HDR_DUPLICATE_DETECTION_ID.toString(), myUniqueID);

...
        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="duplicate.id.cache"></a>37.2.&nbsp;&#37197;&#32622;&#37325;&#22797;ID&#32531;&#23384;</h2></div></div><div></div></div><p>&#26381;&#21153;&#22120;&#32531;&#23384;&#20013;&#20445;&#23384;&#25509;&#25910;&#21040;&#30340;&#28040;&#24687;&#30340;<tt class="literal">org.hornetq.core.message.impl.HDR_DUPLICATE_DETECTION_ID</tt>&#23646;&#24615;&#20540;&#12290;&#27599;&#20010;&#22320;&#22336;&#26377;
              &#21333;&#29420;&#30340;&#32531;&#23384;&#12290;</p><p>&#32531;&#23384;&#30340;&#22823;&#23567;&#26159;&#22266;&#23450;&#30340;&#65292;&#24490;&#29615;&#20351;&#29992;&#12290;&#22914;&#26524;&#32531;&#23384;&#30340;&#26368;&#22823;&#21487;&#20197;&#23384;&#25918;<tt class="literal">n</tt>&#26465;&#35760;&#24405;&#65292;&#37027;&#20040;<tt class="literal">n + 1</tt>&#26465;&#35760;&#24405;&#23558;&#20250;&#35206;&#30422;&#32531;&#23384;&#20013;&#30340;&#31532;<tt class="literal">0</tt>
                &#26465;&#35760;&#24405;&#12290;</p><p>&#32531;&#23384;&#30340;&#26368;&#22823;&#23481;&#37327;&#22312;&#25991;&#20214;<tt class="literal">hornetq-configuration.xml</tt>&#20013;&#37197;&#32622;&#65292;&#21442;&#25968;&#26159;<tt class="literal">id-cache-size</tt>&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">2000</tt>&#26465;&#35760;&#24405;&#12290;</p><p>&#22312;&#25991;&#20214;<tt class="literal">hornetq-configuration.xml</tt>&#20013;&#36824;&#21487;&#20197;&#37197;&#32622;&#23558;&#32531;&#23384;&#25345;&#20037;&#21270;&#21040;&#30913;&#30424;&#12290;&#30456;&#24212;&#30340;&#21442;&#25968;
            &#26159;<tt class="literal">persist-id-cache</tt>&#12290;&#22914;&#26524;&#35774;&#20026;<tt class="literal">true</tt>&#65292;&#21017;&#27599;&#21152;&#20837;&#19968;&#20010;id&#23601;&#23558;
            &#23427;&#21516;&#26102;&#20445;&#23384;&#21040;&#30913;&#30424;&#20013;&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">true</tt>&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>&#27880;&#24847;&#22312;&#35774;&#32622;&#32531;&#23384;&#22823;&#23567;&#26102;&#65292;&#19968;&#23450;&#35201;&#20445;&#35777;&#32531;&#23384;&#33021;&#20445;&#23384;&#36275;&#22816;&#25968;&#37327;&#30340;&#35760;&#24405;&#65292;&#24403;&#28040;&#24687;&#34987;&#37325;&#26032;&#21457;&#36865;&#26102;&#65292;&#20043;&#21069;&#21457;&#36865;&#30340;ID&#19981;&#34987;
                &#35206;&#30422;&#25481;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8949"></a>37.3.&nbsp;&#26725;&#19982;&#37325;&#22797;&#26816;&#27979;</h2></div></div><div></div></div><p>&#26680;&#24515;&#26725;&#21487;&#20197;&#36890;&#36807;&#37197;&#32622;&#22312;&#23558;&#28040;&#24687;&#21457;&#21521;&#30446;&#30340;&#26381;&#21153;&#22120;&#20043;&#21069;&#33258;&#21160;&#21521;&#28040;&#24687;&#20013;&#28155;&#21152;&#21807;&#19968;&#30340;id&#65288;&#22914;&#26524;&#28040;&#24687;&#20013;&#36824;&#27809;&#26377;&#30340;&#35805;&#65289;&#12290;&#36825;&#26679;
            &#22914;&#26524;&#30446;&#30340;&#26381;&#21153;&#22120;&#21457;&#29983;&#25925;&#38556;&#65292;&#26680;&#24515;&#26725;&#22312;&#37325;&#26032;&#21457;&#36865;&#28040;&#24687;&#26102;&#65292;&#30446;&#30340;&#26381;&#21153;&#22120;&#23601;&#21487;&#20197;&#33258;&#21160;&#26816;&#27979;&#37325;&#22797;&#30340;&#28040;&#24687;&#65292;&#21457;&#29616;&#37325;&#22797;&#28040;&#24687;&#21363;&#20002;&#24323;&#12290;</p><p>&#35201;&#37197;&#32622;&#26680;&#24515;&#26725;&#30340;&#33258;&#21160;&#28155;&#21152;id&#30340;&#21151;&#33021;&#65292;&#38656;&#35201;&#22312;<tt class="literal">hornetq-configuration.xml</tt>&#20013;&#26725;&#30340;&#37197;&#32622;
              &#37324;&#23558;<i class="parameter"><tt>use-duplicate-detection</tt></i>&#21442;&#25968;&#35774;&#20026;<tt class="literal">true</tt>&#12290;</p><p>&#36825;&#20010;&#21442;&#25968;&#30340;&#40664;&#35748;&#20540;&#26159;<tt class="literal">true</tt>&#12290;</p><p>&#20851;&#20110;&#26680;&#24515;&#26725;&#30340;&#37197;&#32622;&#21644;&#20351;&#29992;&#65292;&#21442;&#35265;<a href="core-bridges.html" title="Chapter&nbsp;36.&nbsp;&#26680;&#24515;&#26725;">Chapter&nbsp;36, <i>&#26680;&#24515;&#26725;</i></a>&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8974"></a>37.4.&nbsp;&#37325;&#22797;&#26816;&#27979;&#19982;&#38598;&#32676;&#36830;&#25509;</h2></div></div><div></div></div><p>&#38598;&#32676;&#36830;&#25509;&#20869;&#37096;&#20351;&#29992;&#26680;&#24515;&#26725;&#22312;&#33410;&#28857;&#38388;&#21487;&#38752;&#22320;&#31227;&#21160;&#28040;&#24687;&#65292;&#22240;&#27492;&#23427;&#20204;&#30340;&#26680;&#24515;&#26725;&#20063;&#21487;&#20197;&#37197;&#32622;&#33258;&#21160;&#28155;&#21152;id&#30340;&#21151;&#33021;&#12290;</p><p>&#37197;&#32622;&#30340;&#26041;&#27861;&#26159;&#22312;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#23558;&#38598;&#32676;&#36830;&#25509;&#30340;
              <i class="parameter"><tt>use-duplicate-detection</tt></i>&#21442;&#25968;&#35774;&#20026;<tt class="literal">true</tt>&#12290;</p><p>&#36825;&#20010;&#21442;&#25968;&#30340;&#40664;&#35748;&#20540;&#26159;<tt class="literal">true</tt>&#12290;</p><p>&#26377;&#20851;&#38598;&#32676;&#36830;&#25509;&#37197;&#32622;&#30340;&#26356;&#22810;&#20449;&#24687;&#65292;&#35831;&#21442;&#35265;<a href="clusters.html" title="Chapter&nbsp;38.&nbsp;&#38598;&#32676;">Chapter&nbsp;38, <i>&#38598;&#32676;</i></a>&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8999"></a>37.5.&nbsp;&#20998;&#39029;&#36716;&#23384;&#19982;&#37325;&#22797;&#26816;&#27979;</h2></div></div><div></div></div><p>HornetQ&#22312;&#23558;&#28040;&#24687;&#36827;&#34892;&#20998;&#39029;&#36716;&#23384;&#20013;&#20063;&#20351;&#29992;&#20102;&#37325;&#22797;&#26816;&#27979;&#12290;&#24403;&#20998;&#39029;&#36716;&#23384;&#28040;&#24687;&#34987;&#20174;&#30913;&#30424;&#20013;&#35835;&#22238;&#21040;&#20869;&#23384;&#26102;&#65292;&#22914;&#26524;&#26381;&#21153;&#22120;&#21457;&#29983;&#25925;&#38556;&#65292;
            &#37325;&#22797;&#26816;&#27979;&#21487;&#20197;&#36991;&#20813;&#22312;&#36825;&#19968;&#36807;&#31243;&#20013;&#26377;&#28040;&#24687;&#34987;&#37325;&#22797;&#35835;&#20837;&#65292;&#21363;&#36991;&#20813;&#20102;&#28040;&#24687;&#30340;&#37325;&#22797;&#20256;&#36882;&#12290;</p><p>&#20851;&#20110;&#20998;&#39029;&#36716;&#23384;&#30340;&#37197;&#32622;&#20449;&#24687;&#35831;&#21442;&#35265;<a href="paging.html" title="Chapter&nbsp;24.&nbsp;&#20998;&#39029;&#36716;&#23384;">Chapter&nbsp;24, <i>&#20998;&#39029;&#36716;&#23384;</i></a>&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="core-bridges.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="clusters.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;36.&nbsp;&#26680;&#24515;&#26725;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;38.&nbsp;&#38598;&#32676;</td></tr></table></div></body></html>