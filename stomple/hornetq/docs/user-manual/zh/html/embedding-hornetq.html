<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;43.&nbsp;&#23884;&#20837;&#24335;HornetQ</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="logging.html" title="Chapter&nbsp;42.&nbsp;&#26085;&#24535;&#65288;Logging&#65289;"><link rel="next" href="intercepting-operations.html" title="Chapter&nbsp;44.&nbsp;&#25318;&#25130;&#25805;&#20316;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;43.&nbsp;&#23884;&#20837;&#24335;HornetQ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="logging.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="intercepting-operations.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="embedding-hornetq"></a>Chapter&nbsp;43.&nbsp;&#23884;&#20837;&#24335;HornetQ</h2></div></div><div></div></div><p>HornetQ&#26159;&#30001;&#31616;&#21333;&#20256;&#32479;Java&#23545;&#35937;&#65288;POJO&#65289;&#23454;&#29616;&#65292;&#22240;&#27492;&#23427;&#21487;&#20197;&#22312;&#20219;&#20309;&#20381;&#36182;&#27880;&#20837;&#30340;&#26694;&#26550;&#20013;&#36816;&#34892;&#65292;&#27604;&#22914;JBoss
        Microcontainer&#65292;Sprint&#25110;Google Guice&#12290;&#21478;&#22806;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20869;&#37096;&#38656;&#35201;&#28040;&#24687;&#21151;&#33021;&#65292;&#20320;&#21487;&#20197;&#22312;&#31243;&#24207;&#20013;
        <span class="emphasis"><em>&#30452;&#25509;&#23454;&#20363;&#21270;</em></span>HornetQ&#30340;&#23458;&#25143;&#31471;&#25110;&#26381;&#21153;&#22120;&#31471;&#12290;&#25105;&#20204;&#31216;&#20043;&#20026;<span class="emphasis"><em>&#23884;&#20837;&#24335;</em></span>
        HornetQ&#12290;</p><p>&#26377;&#20123;&#24212;&#29992;&#38656;&#35201;&#39640;&#24615;&#33021;&#12289;&#20107;&#21153;&#24615;&#21450;&#25345;&#20037;&#21270;&#30340;&#28040;&#24687;&#26381;&#21153;&#65292;&#20294;&#26159;&#21448;&#19981;&#24076;&#26395;&#33258;&#24049;&#21435;&#36153;&#26102;&#36153;&#21147;&#23454;&#29616;&#23427;&#12290;&#20110;&#26159;&#23884;&#20837;&#24335;HornetQ&#23601;
        &#25104;&#20026;&#20102;&#19968;&#20010;&#24456;&#36866;&#24403;&#30340;&#36873;&#25321;&#12290;</p><p>&#35201;&#20351;&#29992;&#23884;&#20837;&#24335;HornetQ&#21482;&#38656;&#35201;&#20960;&#20010;&#31616;&#21333;&#30340;&#27493;&#39588;&#12290;&#39318;&#20808;&#21021;&#22987;&#21270;&#37197;&#32622;&#23545;&#35937;&#65292;&#20877;&#21021;&#22987;&#21270;&#26381;&#21153;&#22120;&#24182;&#21551;&#21160;&#23427;&#65292;&#22312;&#20320;&#30340;&#34394;&#25311;&#26426;
        &#20013;&#23601;&#36816;&#34892;&#36234;&#26469;&#20102;&#19968;&#20010;HornetQ&#26381;&#21153;&#22120;&#12290;&#23601;&#26159;&#36825;&#20040;&#31616;&#21333;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10550"></a>43.1.&nbsp;POJO&#30340;&#21021;&#22987;&#21270;</h2></div></div><div></div></div><p>&#25353;&#29031;&#20197;&#19979;&#27493;&#39588;&#21435;&#20570;&#65306;</p><p>&#21019;&#24314;&#37197;&#32622;&#23545;&#35937;&#65293;&#65293;&#36825;&#20010;&#23545;&#35937;&#21253;&#35013;&#20102;HornetQ&#30340;&#37197;&#32622;&#20449;&#24687;&#12290;&#22914;&#26524;&#20320;&#24819;&#20351;&#29992;&#37197;&#32622;&#25991;&#20214;&#65292;&#21017;&#20351;&#29992;<tt class="literal">FileConfigurationImpl</tt>&#12290;</p><pre class="programlisting">import org.hornetq.core.config.Configuration;
import org.hornetq.core.config.impl.FileConfiguration;

...


Configuration config = new FileConfiguration();
config.setConfigurationUrl(urlToYourconfigfile);
config.start();</pre><p>&#22914;&#26524;&#19981;&#38656;&#35201;&#37197;&#32622;&#25991;&#20214;&#65292;&#21487;&#20197;&#29992;<tt class="literal">ConfigurationImpl</tt>&#65292;&#21482;&#35201;&#23558;&#20854;&#20013;&#30340;&#21508;&#31181;&#37197;&#32622;&#21442;&#25968;&#35774;&#32622;&#22909;
            &#21363;&#21487;&#12290;&#22914;&#28155;&#21152;&#36866;&#24403;&#30340;&#25509;&#25910;&#22120;&#12290;</p><p><tt class="literal">ConfigurationImpl</tt>&#29992;&#26469;&#37197;&#32622;&#25509;&#25910;&#22120;&#12290;&#21644;&#20027;&#35201;&#37197;&#32622;&#25991;&#20214;&#30456;&#20284;&#65292;&#21482;&#38656;&#35201;&#28155;&#21152;
            <tt class="literal">NettyAcceptorFactory</tt>&#21363;&#21487;&#12290;</p><pre class="programlisting">import org.hornetq.core.config.Configuration;
import org.hornetq.core.config.impl.ConfigurationImpl;

...

Configuration config = new ConfigurationImpl();
HashSet&lt;TransportConfiguration&gt; transports = new HashSet&lt;TransportConfiguration&gt;();
      
transports.add(new TransportConfiguration(NettyAcceptorFactory.class.getName()));
transports.add(new TransportConfiguration(InVMAcceptorFactory.class.getName()));

config.setAcceptorConfigurations(transports);</pre><p>&#25509;&#30528;&#23601;&#38656;&#35201;&#21021;&#22987;&#21270;&#24182;&#21551;&#21160;HornetQ&#26381;&#21153;&#12290;<tt class="literal">org.hornetq.api.core.server.HornetQ</tt>&#31867;&#26377;&#19968;&#20123;&#38745;&#24577;&#26041;&#27861;&#21487;&#29992;&#26469;&#21019;&#24314;HornetQ&#26381;&#21153;&#22120;&#12290;</p><pre class="programlisting">import org.hornetq.api.core.server.HornetQ;
import org.hornetq.core.server.HornetQServer;

...

HornetQServer server = HornetQ.newHornetQServer(config);

server.start();</pre><p>&#20320;&#36824;&#21487;&#20197;&#30452;&#25509;&#23454;&#20363;&#21270;<tt class="literal">HornetQServerImpl</tt>&#65306;</p><pre class="programlisting">HornetQServer server = 
        new HornetQServerImpl(config);
server.start();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10590"></a>43.2.&nbsp;&#20351;&#29992;&#20381;&#36182;&#27880;&#20837;&#26694;&#26550;</h2></div></div><div></div></div><p>&#20320;&#36824;&#21487;&#20197;&#20351;&#29992;&#19968;&#20010;&#20381;&#36182;&#27880;&#20837;&#26694;&#26550;&#26469;&#21551;&#21160;HornetQ&#65292;&#27604;&#22914;<span class="trademark">JBoss
                Microcontainer</span>&#8482;&#25110;<span class="trademark">Spring&#26694;&#26550;</span>&#8482;&#12290;</p><p>HornetQ&#29420;&#31435;&#26381;&#21153;&#22120;&#20351;&#29992;&#30340;&#26159;JBoss Microcontainer&#20316;&#20026;&#20854;&#26694;&#26550;&#12290;&#22312;HornetQ&#30340;&#21457;&#24067;&#20013;&#21253;&#25324;&#30340;<tt class="literal">HornetQBootstrapServer</tt>&#21644;<tt class="literal">hornetq-beans.xml</tt>&#25991;&#20214;&#20849;&#21516;&#23454;&#29616;&#20102;
                &#22312;JBoss Microcontainer&#20013;&#23545;HornetQ&#26381;&#21153;&#22120;&#30340;&#24341;&#23548;&#12290;</p><p>&#35201;&#20351;&#29992;JBoss Microcontainer&#65292;&#38656;&#35201;&#22312;xml&#25991;&#20214;&#20013;&#22768;&#26126;<tt class="literal">HornetQServer</tt>
            &#21644;<tt class="literal">Configuration</tt>&#23545;&#35937;&#12290;&#21478;&#22806;&#36824;&#21487;&#20197;&#27880;&#20837;&#19968;&#20010;&#23433;&#20840;&#31649;&#29702;&#22120;&#21644;&#19968;&#20010;MBean&#26381;&#21153;&#22120;&#12290;&#20294;&#26159;&#36825;&#20123;
            &#27880;&#20837;&#26159;&#21487;&#36873;&#30340;&#12290;</p><p>&#19979;&#38754;&#26159;&#19968;&#20010;&#22522;&#26412;&#30340;JBoss Microcontainer&#30340;XML Bean&#30340;&#22768;&#26126;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;deployment xmlns="urn:jboss:bean-deployer:2.0"&gt;
   
   &lt;!-- The core configuration --&gt;
   &lt;bean name="Configuration" 
         class="org.hornetq.core.config.impl.FileConfiguration"&gt;
   &lt;/bean&gt;

   	&lt;!-- The core server --&gt;
   &lt;bean name="HornetQServer" 
         class="org.hornetq.core.server.impl.HornetQServerImpl"&gt;      
      &lt;constructor&gt;
         &lt;parameter&gt;
            &lt;inject bean="Configuration"/&gt;
         &lt;/parameter&gt;            
      &lt;/constructor&gt;         
   &lt;/bean&gt;
   &lt;/deployment&gt;</pre><p><tt class="literal">HornetQBootstrapServer</tt>&#23454;&#29616;&#20102;JBoss Microcontainer&#30340;&#31616;&#21333;&#23553;&#35013;&#12290;</p><pre class="programlisting">HornetQBootstrapServer bootStrap = 
        new HornetQBootstrapServer(new String[] {"hornetq-beans.xml"});
        bootStrap.run();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10627"></a>43.3.&nbsp;&#36830;&#25509;&#23884;&#20837;&#24335;HornetQ</h2></div></div><div></div></div><p>&#23884;&#20837;&#24335;HornetQ&#30340;&#36830;&#25509;&#21644;&#26222;&#36890;&#30340;&#36830;&#25509;&#19968;&#26679;&#35201;&#21019;&#24314;&#36830;&#25509;&#24037;&#21378;&#65306;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10632"></a>43.3.1.&nbsp;&#26680;&#24515;&#25509;&#21475;</h3></div></div><div></div></div><p>&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#65292;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;<tt class="literal">ClientSessionFactory</tt>&#28982;&#21518;&#27491;&#24120;&#24314;&#31435;&#36830;&#25509;&#12290;</p><pre class="programlisting">ClientSessionFactory nettyFactory =  HornetQClient.createClientSessionFactory(
                                        new TransportConfiguration(
                                           InVMConnectorFactory.class.getName()));

ClientSession session = factory.createSession();

session.createQueue("example", "example", true);

ClientProducer producer = session.createProducer("example");

ClientMessage message = session.createMessage(true);

message.getBody().writeString("Hello");

producer.send(message);

session.start();

ClientConsumer consumer = session.createConsumer("example");

ClientMessage msgReceived = consumer.receive();

System.out.println("message = " + msgReceived.getBody().readString());

session.close();</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10642"></a>43.3.2.&nbsp;JMS&#25509;&#21475;</h3></div></div><div></div></div><p>&#20351;&#29992;JMS&#25509;&#21475;&#36830;&#25509;&#23884;&#20837;HornetQ&#21516;&#26679;&#31616;&#21333;&#12290;&#21482;&#38656;&#35201;&#30452;&#25509;&#23454;&#20363;&#21270;
                    <tt class="literal">ConnectionFactory</tt>&#21363;&#21487;&#12290;&#22914;&#19979;&#38754;&#20363;&#23376;&#25152;&#31034;&#65306;</p><pre class="programlisting">ConnectionFactory cf =
    HornetQJMSClient.createConnectionFactory(
       new TransportConfiguration(InVMConnectorFactory.class.getName()));

Connection conn = cf.createConnection();

conn.start();

Session sess = conn.createSession(true, Session.SESSION_TRANSACTED);

MessageProducer prod = sess.createProducer(queue);

TextMessage msg = sess.createTextMessage("Hello!");

prod.send(msg);

sess.commit();

MessageConsumer consumer = sess.createConsumer(queue);

TextMessage txtmsg = (TextMessage)consumer.receive();

System.out.println("Msg = " + txtmsg.getText());

sess.commit();

conn.close();</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10652"></a>43.4.&nbsp;JMS&#23884;&#20837;&#24335;HornetQ&#30340;&#20363;&#23376;</h2></div></div><div></div></div><p>&#26377;&#20851;&#22914;&#20309;&#35774;&#32622;&#19982;&#36816;&#34892;JMS&#23884;&#20837;&#24335;HornetQ&#30340;&#20363;&#23376;&#35831;&#21442;&#35265;<a href="examples.html#examples.embedded" title="11.2.1.&nbsp;&#23884;&#20837;&#24335;">Section&nbsp;11.2.1, &#8220;&#23884;&#20837;&#24335;&#8221;</a>&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="logging.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="intercepting-operations.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;42.&nbsp;&#26085;&#24535;&#65288;Logging&#65289;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;44.&nbsp;&#25318;&#25130;&#25805;&#20316;</td></tr></table></div></body></html>