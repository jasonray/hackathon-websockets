<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;34.&nbsp;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#19982;&#20250;&#35805;&#24674;&#22797;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="jms-bridge.html" title="Chapter&nbsp;33.&nbsp;JMS&#26725;&#65288;Bridge&#65289;"><link rel="next" href="diverts.html" title="Chapter&nbsp;35.&nbsp;&#28040;&#24687;&#30340;&#36716;&#21457;&#65288;divert)&#19982;&#20998;&#27969;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;34.&nbsp;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#19982;&#20250;&#35805;&#24674;&#22797;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jms-bridge.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="diverts.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="client-reconnection"></a>Chapter&nbsp;34.&nbsp;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#19982;&#20250;&#35805;&#24674;&#22797;</h2></div></div><div></div></div><p>&#36890;&#36807;&#37197;&#32622;&#65292;HornetQ&#30340;&#23458;&#25143;&#31471;&#22312;&#19982;&#26381;&#21153;&#22120;&#30340;&#36830;&#25509;&#20986;&#29616;&#25925;&#38556;&#26102;&#65292;&#21487;&#20197;&#33258;&#21160;&#22320;&#37325;&#26032;&#24314;&#31435;&#36830;&#25509;&#24182;&#24674;&#22797;&#19982;&#26381;&#21153;&#22120;&#30340;&#36890;&#36805;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8244"></a>34.1.&nbsp;100%&#36879;&#26126;&#30340;&#20250;&#35805;&#24674;&#22797;&#65288;re-attachment&#65289;</h2></div></div><div></div></div><p>&#22914;&#26524;&#32593;&#32476;&#20986;&#29616;&#26242;&#26102;&#24615;&#36830;&#25509;&#25925;&#38556;&#65292;&#24182;&#19988;&#26381;&#21153;&#22120;&#27809;&#26377;&#37325;&#21551;&#30340;&#24773;&#20917;&#19979;&#65292;&#24403;&#21069;&#30340;&#20250;&#35805;&#36824;&#20250;&#23384;&#22312;&#26381;&#21153;&#22120;&#20013;&#65292;&#20854;&#29366;&#24577;&#22914;&#21516;&#23458;&#25143;&#31471;
            &#27809;&#26377;&#26029;&#24320;&#36229;&#36807;&#36830;&#25509;TTL<a href="connection-ttl.html" title="Chapter&nbsp;17.&nbsp;&#22833;&#25928;&#36830;&#25509;&#30340;&#26816;&#27979;">Chapter&nbsp;17, <i>&#22833;&#25928;&#36830;&#25509;&#30340;&#26816;&#27979;</i></a>&#26102;&#38388;&#12290;</p><p>&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#24403;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#19978;&#26381;&#21153;&#22120;&#21518;&#65292;HornetQ&#33258;&#21160;&#23558;&#23458;&#25143;&#31471;&#21644;&#20250;&#35805;&#19982;&#26381;&#21153;&#22120;&#31471;&#30340;&#20250;&#35805;&#37325;&#26032;&#36830;&#25509;&#36215;&#26469;&#12290;&#25972;&#20010;&#36807;&#31243;
            &#23545;&#20110;&#23458;&#25143;&#31471;&#26159;&#23436;&#20840;&#36879;&#26126;&#30340;&#65292;&#22312;&#23458;&#25143;&#31471;&#23601;&#22909;&#20687;&#20160;&#20040;&#37117;&#27809;&#26377;&#21457;&#29983;&#19968;&#26679;&#12290;</p><p>&#20855;&#20307;&#24037;&#20316;&#21407;&#29702;&#22914;&#19979;&#65306;</p><p>&#23458;&#25143;&#31471;&#20877;&#21521;&#26381;&#21153;&#22120;&#21457;&#36865;&#21629;&#20196;&#26102;&#65292;&#23427;&#23558;&#27599;&#20010;&#21629;&#20196;&#20445;&#23384;&#21040;&#20869;&#23384;&#30340;&#19968;&#22359;&#32531;&#23384;&#20013;&#12290;&#24403;&#36830;&#25509;&#20986;&#29616;&#25925;&#38556;&#26102;&#23458;&#25143;&#31471;&#20250;&#23581;&#35797;&#19982;&#35813;&#26381;&#21153;
            &#22120;&#24674;&#22797;&#20250;&#35805;&#12290;&#20570;&#20026;&#24674;&#22797;&#21327;&#35758;&#30340;&#19968;&#37096;&#20998;&#65292;&#26381;&#21153;&#22120;&#22312;&#20250;&#35805;&#24674;&#22797;&#26102;&#36890;&#30693;&#23458;&#25143;&#31471;&#26368;&#21518;&#19968;&#20010;&#25104;&#21151;&#25509;&#25910;&#30340;&#21629;&#20196;id&#12290;</p><p>&#26681;&#25454;&#36825;&#20010;&#21629;&#20196;id&#65292;&#23458;&#25143;&#31471;&#21487;&#20197;&#21028;&#26029;&#23427;&#30340;&#32531;&#23384;&#20013;&#26159;&#21542;&#26377;&#21629;&#20196;&#36824;&#26410;&#34987;&#26381;&#21153;&#22120;&#25104;&#21151;&#25509;&#25910;&#12290;&#22914;&#26524;&#26377;&#65292;&#23458;&#25143;&#31471;&#21487;&#20197;&#37325;&#26032;&#21457;&#36865;
            &#36825;&#20123;&#21629;&#20196;&#12290;</p><p>&#32531;&#23384;&#30340;&#22823;&#23567;&#30001;<tt class="literal">ConfirmationWindowSize</tt>&#21442;&#25968;&#20915;&#23450;&#12290;&#24403;&#26381;&#21153;&#22120;&#25104;&#21151;&#25509;&#25910;&#20102;
            <tt class="literal">ConfirmationWindowSize</tt>&#23383;&#33410;&#30340;&#21629;&#20196;&#26102;&#65292;&#20250;&#21521;&#23458;&#25143;&#31471;&#21457;&#36865;&#19968;&#20010;&#21629;&#20196;&#30830;&#35748;&#65292;&#20197;&#20351;&#23458;&#25143;&#31471;
            &#21450;&#26102;&#28165;&#38500;&#32531;&#23384;&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;JMS&#26381;&#21153;&#65292;&#24182;&#19988;JMS&#30340;&#36830;&#25509;&#24037;&#21378;&#26159;&#27880;&#20876;&#21040;JNDI&#30340;&#35805;&#65292;&#30456;&#24212;&#30340;&#21442;&#25968;&#26159;<tt class="literal">hornetq-jms.xml</tt>&#25991;&#20214;&#20013;&#30340;<tt class="literal">confirmation-window-size</tt>&#39033;&#12290;&#22914;&#26524;&#20320;&#24182;&#19981;&#23558;JMS&#36830;&#25509;&#24037;&#21378;&#27880;&#20876;&#21040;JNDI&#65292;&#21017;&#20320;&#38656;&#35201;&#22312;
            <tt class="literal">HornetQConnectionFactory</tt>&#19978;&#20351;&#29992;&#30456;&#24212;&#30340;&#26041;&#27861;&#30452;&#25509;&#35774;&#32622;&#35813;&#21442;&#25968;&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;&#26680;&#24515;&#26381;&#21153;&#65292;&#20320;&#21487;&#20197;&#30452;&#25509;&#22312;<tt class="literal">ClientSessionFactory</tt>&#23454;&#20363;&#19978;&#30452;&#25509;&#35774;&#32622;&#35813;&#21442;&#25968;&#12290;</p><p>&#21442;&#25968;&#30340;&#21333;&#20301;&#26159;&#23383;&#33410;&#12290;</p><p>&#22914;&#26524;&#35813;&#21442;&#25968;&#26159;&#20540;&#35774;&#20026;<tt class="literal">-1</tt>&#65292;&#21017;&#20851;&#38381;&#32531;&#23384;&#65292;&#21363;&#20851;&#38381;&#20102;&#37325;&#26032;&#24674;&#22797;&#21151;&#33021;&#65292;&#36843;&#20351;&#36827;&#34892;&#37325;&#26032;&#36830;&#25509;&#12290;&#40664;&#35748;
              &#20540;&#26159;<tt class="literal">-1</tt>&#65288;&#34920;&#31034;&#27809;&#26377;&#33258;&#21160;&#24674;&#22797;&#65289;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8293"></a>34.2.&nbsp;&#20250;&#35805;&#37325;&#26032;&#36830;&#25509;</h2></div></div><div></div></div><p>&#26377;&#26102;&#26381;&#21153;&#22120;&#21457;&#29983;&#25925;&#38556;&#21518;&#36827;&#34892;&#20102;&#37325;&#21551;&#12290;&#36825;&#26102;&#26381;&#21153;&#22120;&#23558;&#20002;&#22833;&#25152;&#26377;&#24403;&#21069;&#30340;&#20250;&#35805;&#65292;&#19978;&#38754;&#25152;&#36848;&#30340;&#20250;&#35805;&#24674;&#22797;&#23601;&#19981;&#33021;&#20570;&#21040;&#23436;&#20840;&#36879;&#26126;&#20102;&#12290;</p><p>&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;HornetQ&#33258;&#21160;&#22320;&#37325;&#26032;&#24314;&#31435;&#36830;&#25509;&#24182;<span class="italic">&#37325;&#26032;&#21019;&#24314;</span>&#20250;&#35805;
            &#21644;&#25509;&#25910;&#32773;&#12290;&#36825;&#19968;&#36807;&#31243;&#19982;&#21521;&#22791;&#20221;&#26381;&#21153;&#22120;&#36827;&#34892;&#22833;&#25928;&#22791;&#25588;&#65288;failover&#65289;&#23436;&#20840;&#19968;&#26679;&#12290;</p><p>&#23458;&#25143;&#37325;&#26032;&#36830;&#25509;&#30340;&#21151;&#33021;&#36824;&#29992;&#22312;&#20854;&#23427;&#19968;&#20123;&#27169;&#22359;&#19978;&#65292;&#22914;&#26680;&#24515;&#26725;&#65292;&#20197;&#20351;&#23427;&#20204;&#33021;&#22815;&#37325;&#26032;&#36830;&#25509;&#21040;&#30446;&#26631;&#26381;&#21153;&#22120;&#19978;&#12290;</p><p>&#35201;&#20840;&#38754;&#29702;&#35299;&#20107;&#21153;&#24615;&#20250;&#35805;&#21644;&#38750;&#20107;&#21153;&#24615;&#20250;&#35805;&#22312;&#22833;&#25928;&#22791;&#25588;&#65295;&#37325;&#36830;&#25509;&#24773;&#20917;&#19979;&#30340;&#32454;&#33410;&#65292;&#20197;&#21450;&#22914;&#20309;&#20445;&#35777;<span class="italic">
            &#19968;&#27425;&#24182;&#19988;&#21482;&#26377;&#19968;&#27425;</span>&#30340;&#28040;&#24687;&#20256;&#36882;&#65292;&#35831;&#21442;&#35265;<a href="ha.html#ha.automatic.failover" title="39.2.1.&nbsp;&#33258;&#21160;&#23458;&#25143;&#31471;&#22833;&#25928;&#22791;&#25588;">Section&nbsp;39.2.1, &#8220;&#33258;&#21160;&#23458;&#25143;&#31471;&#22833;&#25928;&#22791;&#25588;&#8221;</a>&#30340;&#26377;&#20851;&#20869;&#23481;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8312"></a>34.3.&nbsp;&#37325;&#26032;&#36830;&#25509;&#65295;&#20250;&#35805;&#24674;&#22797;&#30340;&#37197;&#32622;&#21442;&#25968;</h2></div></div><div></div></div><p>&#19979;&#38754;&#26159;&#23458;&#25143;&#31471;&#29992;&#20110;&#37325;&#26032;&#36830;&#25509;&#30340;&#21442;&#25968;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">retry-interval</tt>&#12290;&#21487;&#36873;&#21442;&#25968;&#12290;&#23427;&#20915;&#23450;&#20102;&#20004;&#27425;&#37325;&#26032;&#36830;&#25509;&#23581;&#35797;&#38388;&#38548;&#30340;&#26102;&#38388;&#12290;&#21333;&#20301;
                    &#26159;&#27627;&#31186;&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">2000</tt>&#27627;&#31186;&#12290;</p></li><li><p><tt class="literal">retry-interval-multiplier</tt>&#12290;&#21487;&#36873;&#21442;&#25968;&#12290;&#23427;&#34920;&#31034;&#19979;&#19968;&#27425;&#37325;&#35797;&#26102;&#38388;&#38388;&#38548;&#30340;
                    &#31995;&#25968;&#12290;&#21363;&#19979;&#19968;&#27425;&#37325;&#35797;&#30340;&#26102;&#38388;&#38388;&#38548;&#26159;&#26412;&#27425;&#26102;&#38388;&#38388;&#38548;&#20056;&#20197;&#35813;&#21442;&#25968;&#12290;</p><p>&#36825;&#26679;&#21487;&#20197;&#23454;&#29616;&#37325;&#35797;&#38388;&#38548;&#30340;<span class="emphasis"><em>&#25351;&#25968;&#24310;&#36831;&#65288;exponential backoff&#65289;</em></span>&#12290;</p><p>&#35753;&#25105;&#20204;&#30475;&#19968;&#20010;&#20363;&#23376;&#65306;</p><p>&#20551;&#35774;<tt class="literal">retry-interval</tt>&#20026;<tt class="literal">1000</tt> ms&#65292;&#24182;&#19988;&#25105;&#20204;
                    &#23558;<tt class="literal">retry-interval-multiplier</tt>&#35774;&#20026;<tt class="literal">2.0</tt>&#65292;&#22914;&#26524;
                    &#31532;&#19968;&#27425;&#23581;&#35797;&#22833;&#36133;&#65292;&#21017;&#31561;&#24453;<tt class="literal">1000</tt>&#27627;&#31186;&#21518;&#36827;&#34892;&#31532;&#20108;&#27425;&#37325;&#35797;&#65292;&#22914;&#26524;&#20877;&#22833;&#36133;&#65292;&#21017;&#27599;&#19977;&#27425;&#37325;
                    &#35797;&#35201;&#22312;<tt class="literal">2000</tt>&#27627;&#31186;&#21518;&#36827;&#34892;&#65292;&#31532;&#22235;&#27425;&#35201;&#31561;&#24453;<tt class="literal">4000</tt>&#27627;&#31186;&#65292;
                    &#20197;&#27492;&#31867;&#25512;&#12290;</p><p>&#40664;&#35748;&#20540;&#26159;<tt class="literal">1.0</tt>&#65292;&#34920;&#31034;&#27599;&#27425;&#37325;&#35797;&#38388;&#38548;&#30456;&#21516;&#30340;&#26102;&#38388;&#12290;</p></li><li><p><tt class="literal">max-retry-interval</tt>&#12290;&#21487;&#36873;&#21442;&#25968;&#12290;&#23427;&#20915;&#23450;&#20102;&#37325;&#35797;&#38388;&#30340;&#26368;&#22823;&#26102;&#38388;&#38388;&#38548;&#12290;
                    &#20351;&#29992;<tt class="literal">retry-interval-multiplier</tt>&#21487;&#20197;&#20351;&#37325;&#35797;&#30340;&#26102;&#38388;&#38388;&#38548;&#20197;&#25351;&#25968;&#32423;&#22686;&#21152;&#12290;
                    &#26377;&#21487;&#33021;&#36896;&#25104;&#26102;&#38388;&#38388;&#38548;&#22686;&#21152;&#21040;&#19968;&#20010;&#38750;&#24120;&#22823;&#30340;&#25968;&#20540;&#12290;&#36890;&#36807;&#35774;&#32622;&#19968;&#20010;&#26368;&#22823;&#20540;&#21487;&#23545;&#20854;&#22686;&#38271;&#36827;&#34892;&#38480;&#21046;&#12290;&#40664;&#35748;
                    &#20540;&#26159;<tt class="literal">2000</tt>&#27627;&#31186;&#12290;</p></li><li><p><tt class="literal">reconnect-attempts</tt>&#12290;&#21487;&#36873;&#21442;&#25968;&#12290;&#23427;&#34920;&#31034;&#35201;&#36827;&#34892;&#22810;&#23569;&#37325;&#35797;&#21518;&#25165;&#25918;&#24323;
                    &#24182;&#36864;&#20986;&#12290;<tt class="literal">-1</tt>&#34920;&#31034;&#36827;&#34892;&#26080;&#38480;&#27425;&#37325;&#35797;&#12290;&#40664;&#35748;&#20540;&#26159;<tt class="literal">0</tt>&#12290;</p></li></ul></div><p>&#22914;&#26524;&#20351;&#29992;JMS&#24182;&#19988;&#23558;JMS&#30340;&#36830;&#25509;&#24037;&#21378;&#32465;&#23450;&#21040;JNDI&#26381;&#21153;&#20013;&#65292;&#21017;&#38656;&#35201;&#22312;<tt class="literal">hornetq-jms.xml</tt>
            &#25991;&#20214;&#20013;&#23545;&#36825;&#20123;&#21442;&#25968;&#36827;&#34892;&#37197;&#32622;&#65292;&#22914;&#19979;&#20363;&#25152;&#31034;&#65306;</p><pre class="programlisting">
&lt;connection-factory name="ConnectionFactory"&gt;
&lt;connectors&gt;
   &lt;connector-ref connector-name="netty"/&gt;
&lt;/connectors&gt;
&lt;entries&gt;
   &lt;entry name="ConnectionFactory"/&gt;
   &lt;entry name="XAConnectionFactory"/&gt;
&lt;/entries&gt;
&lt;retry-interval&gt;1000&lt;/retry-interval&gt;
&lt;retry-interval-multiplier&gt;1.5&lt;/retry-interval-multiplier&gt;
&lt;max-retry-interval&gt;60000&lt;/max-retry-interval&gt;
&lt;reconnect-attempts&gt;1000&lt;/reconnect-attempts&gt;
&lt;/connection-factory&gt;          
    </pre><p>&#22914;&#26524;&#20351;&#29992;JMS&#20294;&#26159;&#30452;&#25509;&#23454;&#20363;&#21270;JMS&#36830;&#25509;&#24037;&#21378;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;&#36866;&#24403;&#30340;&#26041;&#27861;&#22312; <tt class="literal">HornetQConnectionFactory</tt> &#23545;&#35937;&#19978;&#30452;&#25509;&#35774;&#32622;&#36825;&#20123;&#21442;&#25968;&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;&#26680;&#24515;&#25509;&#21475;&#30452;&#25509;&#21019;&#24314; <tt class="literal">ClientSessionFactory</tt>&#23454;&#20363;&#65292;&#21017;&#29992;&#23427;&#30340;&#36866;&#24403;&#30340;&#26041;&#27861;&#21487;&#20197;&#35774;&#32622;&#36825;&#20123;&#21442;&#25968;&#12290;</p><p>&#22914;&#26524;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#21518;&#21457;&#29616;&#20250;&#35805;&#24050;&#32463;&#20002;&#22833;&#65288;&#22914;&#26381;&#21153;&#22120;&#37325;&#21551;&#25110;&#36229;&#26102;&#65289;&#65292;&#21017;&#26080;&#27861;&#23436;&#25104;&#24674;&#22797;&#12290;&#22914;&#26524;&#22312;&#36830;&#25509;&#19978;&#25110;&#20250;&#35805;&#19978;&#27880;&#20876;&#20102;
              <tt class="literal">ExceptionListener</tt>&#25110;<tt class="literal">FailureListener</tt>&#65292;
              &#23427;&#20204;&#23558;&#20250;&#34987;&#36890;&#30693;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="client-reconnection.exceptionlistener"></a>34.4.&nbsp;ExceptionListeners and SessionFailureListeners</h2></div></div><div></div></div><p>&#35831;&#27880;&#24847;&#24403;&#23458;&#25143;&#31471;&#36827;&#34892;&#37325;&#26032;&#36830;&#25509;&#25110;&#24674;&#22797;&#20250;&#35805;&#26102;&#65292;&#27880;&#20876;&#30340;JMS <tt class="literal">ExceptionListener</tt> &#25110;&#26680;&#24515;&#25509;&#21475;&#30340; <tt class="literal">SessionFailureListener</tt>
             &#23558;&#20250;&#34987;&#35843;&#29992;&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jms-bridge.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="diverts.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;33.&nbsp;JMS&#26725;&#65288;Bridge&#65289;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;35.&nbsp;&#28040;&#24687;&#30340;&#36716;&#21457;&#65288;divert)&#19982;&#20998;&#27969;</td></tr></table></div></body></html>