<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="undelivered-messages.html" title="Chapter&nbsp;21.&nbsp;&#28040;&#24687;&#20877;&#20256;&#36882;&#21450;&#26410;&#20256;&#36882;&#30340;&#28040;&#24687;"><link rel="next" href="large-messages.html" title="Chapter&nbsp;23.&nbsp;&#22823;&#28040;&#24687;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="undelivered-messages.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="large-messages.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="message-expiry"></a>Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;</h2></div></div><div></div></div><p>&#28040;&#24687;&#22312;&#21457;&#36865;&#26102;&#26377;&#19968;&#20010;&#21487;&#36873;&#30340;<span class="emphasis"><em>&#29983;&#23384;&#26102;&#38388;</em></span>&#23646;&#24615;&#12290;</p><p>&#22914;&#26524;&#19968;&#20010;&#28040;&#24687;&#24050;&#32463;&#36229;&#36807;&#20102;&#23427;&#30340;&#29983;&#23384;&#26102;&#38388;&#65292;HornetQ&#19981;&#20877;&#23558;&#23427;&#20256;&#36882;&#32473;&#20219;&#20309;&#25509;&#25910;&#32773;&#12290;
      &#26381;&#21153;&#22120;&#20250;&#23558;&#36807;&#26399;&#30340;&#28040;&#24687;&#25243;&#24323;&#12290;</p><p>HornetQ&#30340;&#22320;&#22336;&#21487;&#20197;&#37197;&#32622;&#19968;&#20010;&#36807;&#26399;&#22320;&#22336;&#65292;&#24403;&#28040;&#24687;&#36807;&#26399;&#26102;&#65292;&#23427;&#20204;&#34987;&#20174;&#38431;&#21015;&#20013;&#21024;&#38500;&#24182;&#34987;&#36716;&#31227;&#21040;&#36807;&#26399;&#22320;&#22336;&#20013;&#12290;
      &#22810;&#20010;&#19981;&#21516;&#30340;&#38431;&#21015;&#21487;&#20197;&#32465;&#23450;&#21040;&#19968;&#20010;&#36807;&#26399;&#22320;&#22336;&#19978;&#12290;&#36825;&#20123;&#36807;&#26399;&#30340;&#28040;&#24687;&#36807;&#21518;&#21487;&#20197;&#25509;&#25910;&#19979;&#26469;&#20197;&#20379;&#20998;&#26512;&#29992;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4054"></a>22.1.&nbsp;&#36807;&#26399;&#28040;&#24687;&#30340;&#37197;&#32622;</h2></div></div><div></div></div><p>&#22914;&#26524;&#20351;&#29992;HornetQ&#26680;&#24515;API&#65292;&#21487;&#20197;&#30452;&#25509;&#22312;&#28040;&#24687;&#19978;&#35774;&#32622;&#36807;&#26399;&#26102;&#38388;&#65306;</p><pre class="programlisting">
// message will expire in 5000ms from now
message.setExpiration(System.currentTimeMillis() + 5000);         
              </pre><p>JMS&#30340;MessageProducer&#21487;&#20197;&#35774;&#32622;&#19968;&#20010;TimeToLive&#26469;&#25511;&#21046;&#20854;&#21457;&#36865;&#30340;&#28040;&#24687;&#65306;</p><pre class="programlisting">
// messages sent by this producer will be retained for 5s (5000ms) before expiration           
producer.setTimeToLive(5000);
        </pre><p>&#20174;&#36807;&#26399;&#22320;&#22336;&#20013;&#25509;&#25910;&#19979;&#26469;&#30340;&#28040;&#24687;&#26377;&#20197;&#19979;&#23646;&#24615;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">_HQ_ORIG_ADDRESS</tt></p><p>&#36825;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#23427;&#26159;&#35813;&#28040;&#24687;&#30340;<span class="emphasis"><em>&#21407;&#22987;&#22320;&#22336;</em></span>&#12290;</p></li><li><p><tt class="literal">_HQ_ACTUAL_EXPIRY</tt></p><p>&#19968;&#20010;&#38271;&#25972;&#22411;&#37327;&#65292;&#20195;&#34920;&#27492;&#28040;&#24687;<span class="emphasis"><em>&#23454;&#38469;&#36807;&#26399;&#26102;&#38388;</em></span>&#12290;</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-expiry.configuring"></a>22.2.&nbsp;&#37197;&#32622;&#36807;&#26399;&#22320;&#22336;</h2></div></div><div></div></div><p>&#36807;&#26399;&#22320;&#22336;&#37197;&#32622;&#22312;&#22320;&#22336;&#35774;&#32622;&#65288;address-setting&#65289;&#20013;&#65306;</p><pre class="programlisting">
&lt;!-- expired messages in exampleQueue will be sent to the expiry address expiryQueue --&gt;
&lt;address-setting match="jms.queue.exampleQueue"&gt;
   &lt;expiry-address&gt;jms.queue.expiryQueue&lt;/expiry-address&gt;
&lt;/address-setting&gt;
        </pre><p>&#22914;&#26524;&#27809;&#26377;&#23450;&#20041;&#36807;&#26399;&#22320;&#22336;&#65292;&#24403;&#19968;&#20010;&#28040;&#24687;&#36807;&#26399;&#26102;&#65292;&#23427;&#23558;&#34987;&#21024;&#38500;&#12290;&#37197;&#32622;&#36807;&#26399;&#22320;&#22336;&#26102;&#21487;&#20197;&#20351;&#29992;&#36890;&#37197;&#31526;
         &#26469;&#32473;&#19968;&#32452;&#22320;&#22336;&#37197;&#32622;&#36807;&#26399;&#22320;&#22336;&#12290;&#65288;&#21442;&#35265;<a href="wildcard-syntax.html" title="Chapter&nbsp;13.&nbsp;&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;">Chapter&nbsp;13, <i>&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;</i></a>&#65289;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring.expiry.reaper"></a>22.3.&nbsp;&#37197;&#32622;&#36807;&#26399;&#22238;&#25910;&#32447;&#31243;</h2></div></div><div></div></div><p>HornetQ&#26377;&#19968;&#20010;&#22238;&#25910;&#32447;&#31243;&#23450;&#26399;&#22320;&#26816;&#26597;&#38431;&#21015;&#20013;&#30340;&#28040;&#24687;&#65292;&#30446;&#30340;&#26159;&#21457;&#29616;&#26159;&#21542;&#26377;&#28040;&#24687;&#36807;&#26399;&#12290;</p><p>&#22312;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#21487;&#20197;&#23545;&#22238;&#25910;&#32447;&#31243;&#36827;&#34892;&#37197;&#32622;&#65292;&#21442;&#25968;&#22914;&#19979;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">message-expiry-scan-period</tt></p><p>&#36807;&#26399;&#28040;&#24687;&#30340;&#25195;&#25551;&#38388;&#38548;&#65288;&#21333;&#20301;&#27627;&#31186;&#65292;&#40664;&#35748;&#20026;30000ms&#65289;&#12290;&#22914;&#35201;&#20851;&#38381;&#25195;&#25551;&#65292;&#23558;&#20854;&#35774;&#20026;<tt class="literal">-1</tt>&#12290;</p></li><li><p><tt class="literal">message-expiry-thread-priority</tt></p><p>&#22238;&#25910;&#32447;&#31243;&#30340;&#20248;&#20808;&#32423;&#65288;&#20026;0&#21040;9&#30340;&#25972;&#25968;&#65292;9&#20248;&#20808;&#32423;&#26368;&#39640;&#12290;&#40664;&#35748;&#26159;3&#65289;&#12290;</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4123"></a>22.4.&nbsp;&#20363;&#23376;</h2></div></div><div></div></div><p>&#21442;&#35265;<a href="examples.html#examples.expiry" title="11.1.28.&nbsp;&#28040;&#24687;&#22833;&#25928;">Section&nbsp;11.1.28, &#8220;&#28040;&#24687;&#22833;&#25928;&#8221;</a>&#12290;&#36825;&#20010;&#20363;&#23376;&#23637;&#31034;&#20102;&#22312;JMS&#20013;&#22914;&#20309;&#37197;&#32622;&#20351;&#29992;&#28040;&#24687;&#36807;&#26399;&#21151;&#33021;&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="undelivered-messages.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="large-messages.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;21.&nbsp;&#28040;&#24687;&#20877;&#20256;&#36882;&#21450;&#26410;&#20256;&#36882;&#30340;&#28040;&#24687;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;23.&nbsp;&#22823;&#28040;&#24687;</td></tr></table></div></body></html>