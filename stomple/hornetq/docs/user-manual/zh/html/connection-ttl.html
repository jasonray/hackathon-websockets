<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;17.&nbsp;&#22833;&#25928;&#36830;&#25509;&#30340;&#26816;&#27979;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="configuring-transports.html" title="Chapter&nbsp;16.&nbsp;&#20256;&#36755;&#23618;&#30340;&#37197;&#32622;"><link rel="next" href="transaction-config.html" title="Chapter&nbsp;18.&nbsp;&#37197;&#32622;&#36164;&#28304;&#31649;&#29702;&#22120;&#65288;Resource Manager&#65289;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;17.&nbsp;&#22833;&#25928;&#36830;&#25509;&#30340;&#26816;&#27979;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configuring-transports.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="transaction-config.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="connection-ttl"></a>Chapter&nbsp;17.&nbsp;&#22833;&#25928;&#36830;&#25509;&#30340;&#26816;&#27979;</h2></div></div><div></div></div><p>&#26412;&#31456;&#23558;&#35752;&#35770;&#36830;&#25509;&#30340;&#29983;&#23384;&#26102;&#38388;&#65288;TTL&#65289;&#20197;&#21450;HornetQ&#22914;&#20309;&#22788;&#29702;&#20986;&#29616;&#25925;&#38556;&#30340;&#23458;&#25143;&#31471;&#25110;&#32773;&#24322;&#24120;&#36864;&#20986;&#30340;&#23458;&#25143;&#31471;&#65288;&#21363;&#23458;&#25143;&#31471;&#22312;
        &#36864;&#20986;&#26102;&#27809;&#26377;&#21512;&#29702;&#30340;&#20851;&#38381;&#30456;&#20851;&#36164;&#28304;&#65289;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dead.connections"></a>17.1.&nbsp;&#26381;&#21153;&#22120;&#31471;&#23545;&#22833;&#25928;&#36830;&#25509;&#30340;&#28165;&#38500;</h2></div></div><div></div></div><p>&#24403;&#23458;&#25143;&#31471;&#30340;&#24212;&#29992;&#31243;&#24207;&#36864;&#20986;&#26102;&#65292;&#24212;&#35813;&#20851;&#38381;&#25152;&#20351;&#29992;&#30340;&#36164;&#28304;&#12290;&#22312;<tt class="literal">finally</tt>&#36827;&#34892;&#36164;&#28304;&#30340;&#20851;&#38381;
            &#26159;&#19968;&#20010;&#24456;&#22909;&#30340;&#26041;&#27861;&#12290;</p><p>&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#19968;&#20010;Hornet&#23458;&#25143;&#31471;&#22312;finally&#20013;&#20851;&#38381;&#20102;&#23427;&#30340;&#20250;&#35805;&#65288;session&#65289;&#21644;&#20250;&#35805;&#24037;&#21378;&#65288;session factory&#65289;&#65306;</p><pre class="programlisting">
ClientSessionFactory sf = null;
ClientSession session = null;

try
{
   sf = HornetQClient.createClientSessionFactory(...);

   session = sf.createSession(...);
   
   ... do some stuff with the session...
}
finally
{
   if (session != null)
   {
      session.close();
   }
   
   if (sf != null)
   {
      sf.close();
   }
}
        </pre><p>&#19979;&#38754;&#30340;&#20363;&#23376;&#32473;&#20986;&#20102;&#19968;&#20010;JMS&#23458;&#25143;&#31471;&#26159;&#22914;&#20309;&#36866;&#24403;&#20851;&#38381;&#30456;&#20851;&#36164;&#28304;&#30340;&#65306;</p><pre class="programlisting">
Connection jmsConnection = null;

try
{
   ConnectionFactory jmsConnectionFactory = HornetQJMSClient.createConnectionFactory(...);

   jmsConnection = jmsConnectionFactory.createConnection();

   ... do some stuff with the connection...
}
finally
{
   if (connection != null)
   {
      connection.close();
   }
}
        </pre><p>&#28982;&#32780;&#26377;&#26102;&#20505;&#36164;&#28304;&#22312;&#23458;&#25143;&#31471;&#24471;&#19981;&#21040;&#21512;&#29702;&#30340;&#20851;&#38381;&#12290;&#26377;&#30340;&#23458;&#25143;&#31471;&#24212;&#29992;&#22312;&#32467;&#26463;&#26102;&#24536;&#35760;&#20102;&#20851;&#38381;&#36164;&#28304;&#65292;&#26377;&#30340;&#23458;&#25143;&#31471;&#26377;&#26102;&#21457;&#29983;&#25925;&#38556;&#23548;&#33268;
            &#31243;&#24207;&#31361;&#28982;&#20013;&#26029;&#65292;&#30456;&#20851;&#36164;&#28304;&#20063;&#27809;&#26377;&#26469;&#24471;&#21450;&#20851;&#38381;&#65281;</p><p>&#22914;&#26524;&#19978;&#36848;&#24773;&#20917;&#21457;&#29983;&#20102;&#65292;&#37027;&#20040;&#36825;&#20123;&#36164;&#28304;&#23601;&#20250;&#30041;&#22312;&#26381;&#21153;&#22120;&#31471;&#32780;&#19981;&#20250;&#34987;&#28165;&#29702;&#12290;&#36825;&#23601;&#20250;&#36896;&#25104;&#36164;&#28304;&#27844;&#28431;&#29616;&#35937;&#24182;&#26368;&#32066;&#23548;&#33268;&#26381;&#21153;&#22120;&#20869;&#23384;
            &#28322;&#20986;&#25110;&#20854;&#23427;&#36164;&#28304;&#30340;&#28322;&#20986;&#38169;&#35823;&#12290;</p><p>&#22240;&#27492;&#22312;&#26381;&#21153;&#22120;&#31471;&#35201;&#26377;&#26576;&#31181;&#26426;&#21046;&#26469;&#36991;&#20813;&#36164;&#28304;&#30340;&#27844;&#28431;&#12290;&#20063;&#23601;&#26159;&#23545;&#26080;&#25928;&#36164;&#28304;&#36827;&#34892;&#22238;&#25910;&#12290;&#22312;&#21028;&#26029;&#20160;&#20040;&#26159;&#26080;&#25928;&#36164;&#28304;&#26102;&#65292;HornetQ
            &#32771;&#34385;&#21040;&#20102;&#23458;&#25143;&#31471;&#37325;&#26032;&#36830;&#25509;&#30340;&#24773;&#20917;&#12290;&#23601;&#26159;&#24403;&#19968;&#20010;&#36830;&#25509;&#30001;&#20110;&#32593;&#32476;&#20020;&#26102;&#20013;&#26029;&#21518;&#21448;&#24674;&#22797;&#27491;&#24120;&#26102;&#65292;&#23458;&#25143;&#31471;&#26377;&#21487;&#33021;&#36890;&#36807;&#19981;&#26029;&#37325;&#35797;
            &#25104;&#21151;&#22320;&#36830;&#25509;&#21040;&#26381;&#21153;&#22120;&#31471;&#12290;&#22914;&#26524;&#26381;&#21153;&#22120;&#31471;&#36807;&#26089;&#28165;&#38500;&#20102;&#30456;&#20851;&#30340;&#36830;&#25509;&#36164;&#28304;&#65292;&#21017;&#23458;&#25143;&#31471;&#23601;&#21487;&#33021;&#37325;&#35797;&#22833;&#36133;&#12290;</p><p>HornetQ&#30340;&#36164;&#28304;&#22238;&#25910;&#26159;&#23436;&#20840;&#21487;&#37197;&#32622;&#30340;&#12290;&#27599;&#20010; <tt class="literal">ClientSessionFactory</tt> &#26377;&#19968;&#20010;<span class="emphasis"><em>&#36830;&#25509; TTL</em></span>&#30340;&#21442;&#25968;&#12290;
            &#36825;&#20010;&#21442;&#25968;&#30340;&#24847;&#20041;&#26159;&#24403;&#23458;&#25143;&#31471;&#30340;&#19968;&#20010;&#36830;&#25509;&#27809;&#26377;&#20219;&#20309;&#25968;&#21040;&#36798;&#26381;&#21153;&#22120;&#26102;&#65292;&#26381;&#21153;&#22120;&#20805;&#35768;&#36825;&#20010;&#36830;&#25509;&#26377;&#25928;&#30340;&#26368;&#38271;&#26102;&#38388;&#12290;&#23458;&#25143;&#31471;&#36890;&#36807;&#23450;
            &#26102;&#21521;&#26381;&#21153;&#22120;&#31471;&#21457;&#36865;&#8220;ping&#8220;&#25968;&#25454;&#21253;&#26469;&#32500;&#25345;&#36830;&#25509;&#30340;&#26377;&#25928;&#65292;&#20197;&#20813;&#34987;&#26381;&#21153;&#22120;&#20851;&#25481;&#12290;&#22914;&#26524;&#26381;&#21153;&#22120;&#22312;TTL&#25351;&#23450;&#30340;&#26102;&#38388;&#20869;&#27809;&#26377;&#25910;&#21040;&#20219;&#20309;
            &#25968;&#25454;&#21253;&#65292;&#21017;&#35748;&#20026;&#35813;&#36830;&#25509;&#26080;&#25928;&#65292;&#32487;&#32780;&#20851;&#38381;&#19982;&#35813;&#36830;&#25509;&#30456;&#20851;&#30340;&#25152;&#26377;&#30340;&#20250;&#35805;&#65288;session&#65289;&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;JMS&#65292;<tt class="literal">HornetQConnectionFactory</tt>&#30340;<tt class="literal">ConnectionTTL</tt>
            &#23646;&#24615;&#26159;&#29992;&#26469;&#23450;&#20041;&#36830;&#25509;&#30340;&#23384;&#27963;&#26102;&#38388;&#30340;&#12290;&#22914;&#26524;&#20320;&#23558;JMS&#36830;&#25509;&#24037;&#21378;&#37096;&#32626;&#21040;JNDI&#20013;&#65292;&#21017;&#24212;&#20351;&#29992;&#37197;&#32622;&#25991;&#20214;&#20013;&#30340;<tt class="literal">connection-ttl</tt>&#21442;&#25968;&#26469;&#23450;&#20041;&#36830;&#25509;&#30340;TTL&#12290;</p><p>&#40664;&#35748;&#30340;&#36830;&#25509;TTL&#20540;&#26159;<tt class="literal">60000</tt>&#27627;&#31186;&#65292;&#21363;&#19968;&#20998;&#38047;&#12290; <tt class="literal">ConnectionTTL</tt>
            &#35774;&#20026;<tt class="literal">-1</tt>&#34920;&#31034;&#26381;&#21153;&#22120;&#27704;&#36828;&#19981;&#26816;&#27979;&#36229;&#26102;&#30340;&#36830;&#25509;&#12290;</p><p>&#22914;&#26524;&#20320;&#19981;&#24819;&#35753;&#23458;&#25143;&#31471;&#26469;&#35268;&#23450;&#36830;&#25509;&#23384;&#27963;&#26102;&#38388;&#65288;TTL&#65289;&#65292;&#20320;&#21487;&#20197;&#22312;&#26381;&#21153;&#22120;&#31471;&#30340;&#37197;&#32622;&#25991;&#20214;&#20013;&#23450;&#20041;
            <tt class="literal">connection-ttl-override</tt>&#23646;&#24615;&#12290;&#23427;&#30340;&#40664;&#35748;&#20540;&#26159;<tt class="literal">-1</tt>&#65292;&#34920;&#31034;
            &#26381;&#21153;&#22120;&#31471;&#35813;&#23646;&#24615;&#26080;&#25928;&#65288;&#21363;&#23458;&#25143;&#31471;&#21487;&#20197;&#23450;&#20041;&#33258;&#24049;&#30340;&#36830;&#25509;TTL&#65289;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3243"></a>17.1.1.&nbsp;&#20851;&#38381;&#27809;&#26377;&#34987;&#25104;&#21151;&#20851;&#38381;&#30340;&#26680;&#24515;&#20250;&#35805;&#25110;JMS&#36830;&#25509;</h3></div></div><div></div></div><p>&#22914;&#21069;&#25152;&#36848;&#65292;&#22312;&#20351;&#29992;&#23436;&#27605;&#21518;&#22312;<tt class="literal">finally</tt>&#20013;&#23558;&#25152;&#26377;&#30340;&#26680;&#24515;&#20250;&#35805;&#25110;JMS&#36830;&#25509;&#20851;&#38381;&#26159;&#21313;&#20998;&#37325;&#35201;&#30340;&#12290;</p><p>&#22914;&#26524;&#20320;&#27809;&#26377;&#36825;&#26679;&#20570;&#65292;HornetQ&#20250;&#22312;&#25289;&#22334;&#22238;&#25910;&#26102;&#36827;&#34892;&#26816;&#27979;&#24182;&#20250;&#22312;&#26085;&#24535;&#20013;&#25171;&#21360;&#31867;&#20284;&#20197;&#19979;&#30340;&#35686;&#21578;&#65288;&#22914;&#26524;&#26159;JMS&#21017;&#22312;&#35686;&#21578;&#20013;
                  &#26159;&#30456;&#24212;&#30340;JMS&#36830;&#25509;&#65289;&#65306;</p><pre class="programlisting">
                
[Finalizer] 20:14:43,244 WARNING [org.hornetq.core.client.impl.DelegatingSession]  I'm closin
g a ClientSession you left open. Please make sure you close all ClientSessions explicitly before let
ting them go out of scope!
[Finalizer] 20:14:43,244 WARNING [org.hornetq.core.client.impl.DelegatingSession]  The sessi
on you didn't close was created here:
java.lang.Exception
at org.hornetq.core.client.impl.DelegatingSession.&lt;init&gt;(DelegatingSession.java:83)
at org.acme.yourproject.YourClass (YourClass.java:666)    
                
            </pre><p>HornetQ&#28982;&#21518;&#23558;&#26410;&#20851;&#38381;&#30340;&#36830;&#25509;&#65295;&#20250;&#35805;&#20851;&#38381;&#12290;</p><p>&#27880;&#24847;&#22312;&#26085;&#24535;&#30340;&#35686;&#21578;&#20013;&#36824;&#32473;&#20986;&#20102;&#21019;&#24314;JMS&#36830;&#25509;&#65295;&#23458;&#25143;&#31471;&#20250;&#35805;&#30340;&#20855;&#20307;&#34892;&#21495;&#65292;&#20197;&#20415;&#20934;&#30830;&#22320;&#30830;&#23450;&#20986;&#38169;&#30340;&#22320;&#26041;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3259"></a>17.2.&nbsp;&#23458;&#25143;&#31471;&#30340;&#25925;&#38556;&#26816;&#27979;</h2></div></div><div></div></div><p>&#21069;&#38754;&#35762;&#36848;&#20102;&#23458;&#25143;&#31471;&#22914;&#20309;&#21521;&#26381;&#21153;&#22120;&#21457;&#36865;ping&#20197;&#21450;&#26381;&#21153;&#22120;&#31471;&#22914;&#20309;&#28165;&#29702;&#22833;&#25928;&#30340;&#36830;&#25509;&#12290;&#21457;&#36865;ping&#36824;&#26377;&#21478;&#22806;&#19968;&#20010;&#30446;&#30340;&#65292;&#23601;&#26159;&#33021;
            &#35753;&#23458;&#25143;&#31471;&#26816;&#27979;&#32593;&#32476;&#25110;&#26381;&#21153;&#22120;&#26159;&#21542;&#20986;&#29616;&#25925;&#38556;&#12290;</p><p>&#20174;&#23458;&#25143;&#31471;&#30340;&#35282;&#24230;&#26469;&#30475;&#65292;&#21482;&#35201;&#23458;&#25143;&#31471;&#33021;&#20174;&#19968;&#20010;&#36830;&#25509;&#19981;&#26029;&#25509;&#25910;&#26381;&#21153;&#22120;&#30340;&#25968;&#25454;&#65292;&#37027;&#20040;&#36825;&#20010;&#36830;&#25509;&#23601;&#34987;&#35748;&#20026;&#26159;&#19968;&#20010;&#26377;&#25928;&#30340;&#36830;&#25509;&#12290;</p><p>&#22914;&#26524;&#22312;&#23646;&#24615;<tt class="literal">client-failure-check-period</tt>&#25152;&#23450;&#20041;&#30340;&#26102;&#38388;&#20869;&#65288;&#21333;&#20301;&#27627;&#31186;&#65289;&#23458;&#25143;&#31471;&#27809;&#26377;
            &#25910;&#21040;&#20219;&#20309;&#25968;&#25454;&#65292;&#23458;&#25143;&#31471;&#23601;&#35748;&#20026;&#36825;&#20204;&#36830;&#25509;&#21457;&#29983;&#20102;&#25925;&#38556;&#12290;&#26681;&#25454;&#19981;&#21516;&#30340;&#37197;&#32622;&#65292;&#23458;&#25143;&#31471;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#35201;&#20040;&#36827;&#34892;failover&#65292;&#35201;&#20040;
            &#35843;&#29992;<tt class="literal">FailureListener</tt>&#30340;&#25509;&#21475;&#65288;&#25110;&#32773;&#26159;JMS&#30340;<tt class="literal">ExceptionListener</tt>&#65289;&#12290;</p><p>&#22914;&#26524;&#20351;&#29992;JMS&#65292;&#36825;&#20010;&#21442;&#25968;&#26159;<tt class="literal">HornetQConnectionFactory</tt>&#30340;<tt class="literal">ClientFailureCheckPeriod</tt>&#12290;
            &#22914;&#26524;&#20320;&#21521;JNDI&#37096;&#32626;JMS&#36830;&#25509;&#24037;&#21378;&#65292;&#37027;&#20040;&#30456;&#24212;&#30340;&#21442;&#25968;&#22312;<tt class="literal">hornetq-jms.xml</tt>&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;&#21442;&#25968;&#21517;
            &#20026;<tt class="literal">client-failure-check-period</tt>&#12290;</p><p>&#36825;&#20010;&#21442;&#25968;&#30340;&#40664;&#35748;&#20540;&#26159;<tt class="literal">30000</tt>&#27627;&#31186;&#65292;&#21363;&#21322;&#20998;&#38047;&#12290;<tt class="literal">-1</tt>&#34920;&#31034;&#23458;&#25143;&#31471;&#19981;&#26816;&#26597;
            &#36830;&#25509;&#30340;&#26377;&#25928;&#24615;&#12290;&#21363;&#19981;&#35770;&#26159;&#21542;&#26377;&#25968;&#25454;&#26469;&#33258;&#26381;&#21153;&#22120;&#65292;&#36830;&#25509;&#37117;&#19968;&#30452;&#26377;&#25928;&#12290;&#36825;&#19968;&#21442;&#25968;&#36890;&#24120;&#35201;&#27604;&#26381;&#21153;&#22120;&#31471;&#30340;&#36830;&#25509;TTL&#23567;&#35768;&#22810;&#65292;&#20197;&#20351;
            &#23458;&#25143;&#31471;&#22312;&#20986;&#29616;&#30701;&#26242;&#36830;&#25509;&#25925;&#38556;&#30340;&#24773;&#20917;&#19979;&#21487;&#20197;&#19982;&#26381;&#21153;&#22120;&#25104;&#21151;&#22320;&#37325;&#26032;&#36830;&#25509;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connection-ttl.async-connection-execution"></a>17.3.&nbsp;&#37197;&#32622;&#24322;&#27493;&#36830;&#25509;&#20219;&#21153;&#25191;&#34892;</h2></div></div><div></div></div><p>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#26381;&#21153;&#22120;&#25509;&#25910;&#21040;&#30340;&#25968;&#25454;&#21253;&#34987;&#36828;&#31243;&#27169;&#22359;&#30340;&#32447;&#31243;&#22788;&#29702;&#12290;</p><p>&#20026;&#20102;&#36991;&#20813;&#36828;&#31243;&#27169;&#22359;&#30340;&#32447;&#31243;&#34987;&#38271;&#26102;&#38388;&#21344;&#29992;&#65292;&#25968;&#25454;&#21253;&#21487;&#20197;&#36716;&#32473;&#21478;&#22806;&#30340;&#19968;&#20010;&#32447;&#31243;&#27744;&#26469;&#22788;&#29702;&#12290;&#35201;&#27880;&#24847;&#36825;&#26679;&#20570;&#30340;&#22686;&#21152;&#20102;&#19968;&#20123;&#26102;&#38388;&#24310;&#36831;&#12290;
            &#22240;&#27492;&#22914;&#26524;&#25968;&#25454;&#21253;&#22788;&#29702;&#32791;&#26102;&#24456;&#23569;&#65292;&#36824;&#26159;&#30001;&#36828;&#31243;&#27169;&#22359;&#32447;&#31243;&#26469;&#22788;&#29702;&#36739;&#22909;&#12290;

            &#35201;&#37197;&#32622;&#36825;&#26679;&#30340;&#24322;&#27493;&#36830;&#25509;&#24456;&#34892;&#20219;&#21153;&#65292;&#23558;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#30340;
                <tt class="literal">async-connection-execution-enabled</tt> &#21442;&#25968;&#35774;&#20026;<tt class="literal">true</tt>
               &#65288;&#40664;&#35748;&#20540;&#26159; <tt class="literal">true</tt>&#65289;&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configuring-transports.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="transaction-config.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;16.&nbsp;&#20256;&#36755;&#23618;&#30340;&#37197;&#32622;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;18.&nbsp;&#37197;&#32622;&#36164;&#28304;&#31649;&#29702;&#22120;&#65288;Resource Manager&#65289;</td></tr></table></div></body></html>