<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;21.&nbsp;&#28040;&#24687;&#20877;&#20256;&#36882;&#21450;&#26410;&#20256;&#36882;&#30340;&#28040;&#24687;</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="up" href="index.html" title="HornetQ 2.1&#29992;&#25143;&#25163;&#20876;"><link rel="previous" href="send-guarantees.html" title="Chapter&nbsp;20.&nbsp;&#21457;&#36865;&#19982;&#25552;&#20132;&#30340;&#20445;&#35777;"><link rel="next" href="message-expiry.html" title="Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;21.&nbsp;&#28040;&#24687;&#20877;&#20256;&#36882;&#21450;&#26410;&#20256;&#36882;&#30340;&#28040;&#24687;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="send-guarantees.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="message-expiry.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="undelivered-messages"></a>Chapter&nbsp;21.&nbsp;&#28040;&#24687;&#20877;&#20256;&#36882;&#21450;&#26410;&#20256;&#36882;&#30340;&#28040;&#24687;</h2></div></div><div></div></div><p>&#28040;&#24687;&#26377;&#21487;&#33021;&#20256;&#36882;&#22833;&#36133;&#65288;&#27604;&#22914;&#30456;&#20851;&#30340;&#20107;&#21153;&#21457;&#29983;&#22238;&#28378;&#65289;&#12290;&#22833;&#36133;&#30340;&#28040;&#24687;&#23558;&#36864;&#22238;&#21040;&#38431;&#21015;&#20013;&#20934;&#22791;&#37325;&#26032;&#20256;&#36882;&#12290;&#36825;&#26679;&#23601;&#20250;&#20986;&#29616;
      &#19968;&#31181;&#24773;&#20917;&#65292;&#23601;&#26159;&#21516;&#19968;&#20010;&#28040;&#24687;&#20250;&#34987;&#21453;&#22797;&#30340;&#20256;&#36882;&#32780;&#24635;&#19981;&#25104;&#21151;&#65292;&#20197;&#33267;&#20110;&#20351;&#31995;&#32479;&#22788;&#20110;&#24537;&#30340;&#29366;&#24577;&#12290;</p><p>&#23545;&#20110;&#36825;&#26679;&#30340;&#28040;&#24687;&#25105;&#20204;&#26377;&#20004;&#31181;&#22788;&#29702;&#26041;&#27861;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#24310;&#36831;&#20877;&#20256;&#36882;</p><p>&#36825;&#31181;&#26041;&#27861;&#26159;&#35753;&#28040;&#24687;&#20877;&#27425;&#20256;&#36882;&#26102;&#26377;&#19968;&#23450;&#30340;&#26102;&#38388;&#24310;&#36831;&#65292;&#36825;&#26679;&#23458;&#25143;&#31471;&#23601;&#26377;&#26426;&#20250;&#20174;&#25925;&#38556;&#20013;&#24674;&#22797;&#65292;&#21516;&#26102;&#32593;&#32476;&#36830;&#25509;&#21644;CPU&#36164;&#28304;
            &#20063;&#19981;&#33268;&#20110;&#34987;&#36807;&#24230;&#21344;&#29992;&#12290;</p></li><li><p>&#27515;&#20449;&#65288;Dead Letter&#65289;&#22320;&#22336;</p><p>&#36825;&#31181;&#26041;&#27861;&#26159;&#35268;&#23450;&#19968;&#20010;&#27515;&#20449;&#22320;&#22336;&#65292;&#22914;&#26524;&#28040;&#24687;&#20877;&#34987;&#21453;&#22797;&#20256;&#36882;&#36798;&#21040;&#19968;&#23450;&#27425;&#25968;&#26102;&#65292;&#23601;&#20250;&#20174;&#21407;&#26377;&#38431;&#21015;&#20013;&#21024;&#38500;&#65292;&#36716;&#21040;&#36825;&#20010;
            &#27515;&#20449;&#22320;&#22336;&#20013;&#12290;&#36825;&#26679;&#28040;&#24687;&#23601;&#19981;&#20250;&#27704;&#36828;&#22320;&#37325;&#22797;&#20256;&#36882;&#20102;&#12290;</p></li></ul></div><p>&#20197;&#19978;&#20004;&#31181;&#26041;&#27861;&#21487;&#20197;&#21512;&#29702;&#25645;&#37197;&#20351;&#29992;&#65292;&#20351;&#35299;&#20915;&#26041;&#26696;&#26356;&#21152;&#28789;&#27963;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3892"></a>21.1.&nbsp;&#24310;&#36831;&#20877;&#20256;&#36882;</h2></div></div><div></div></div><p>&#24310;&#36831;&#20877;&#20256;&#36882;&#23545;&#20110;&#26102;&#24120;&#20986;&#29616;&#25925;&#38556;&#25110;&#22238;&#28378;&#30340;&#23458;&#25143;&#31471;&#21313;&#20998;&#26377;&#29992;&#12290;&#22914;&#26524;&#27809;&#26377;&#24310;&#36831;&#65292;&#25972;&#20010;&#31995;&#32479;&#21487;&#33021;&#20250;&#22788;&#20110;&#19968;&#31181;&#8221;&#30127;&#29378;&#8220;&#30340;&#29366;&#24577;&#12290;
         &#23601;&#26159;&#28040;&#24687;&#34987;&#20256;&#36882;&#12289;&#22238;&#28378;&#12289;&#20877;&#20256;&#36882;&#65292;&#36825;&#26679;&#21453;&#22797;&#19981;&#38388;&#26029;&#22320;&#36827;&#34892;&#30528;&#65292;&#23558;&#23453;&#36149;&#30340;CPU&#21644;&#32593;&#32476;&#36164;&#28304;&#21344;&#29992;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="undelivered-messages.delay"></a>21.1.1.&nbsp;&#24310;&#36831;&#20877;&#20256;&#36882;&#30340;&#37197;&#32622;</h3></div></div><div></div></div><p>&#24310;&#36831;&#20877;&#20256;&#36882;&#30340;&#37197;&#32622;&#22312;&#22320;&#22336;&#35774;&#23450;&#20869;&#65288;address-setting&#65289;&#65306;</p><pre class="programlisting">
     &lt;!-- delay redelivery of messages for 5s --&gt;
     &lt;address-setting match="jms.queue.exampleQueue"&gt;
        &lt;redelivery-delay&gt;5000&lt;/redelivery-delay&gt;
     &lt;/address-setting&gt;
             </pre><p>&#22914;&#26524;&#23450;&#20041;&#20102;<tt class="literal">redelivery-delay</tt>&#65292;HornetQ&#22312;&#20877;&#20256;&#36882;&#20043;&#21069;&#31561;&#24453;&#25152;&#23450;&#20041;&#30340;&#26102;&#38388;&#12290;</p><p>&#40664;&#35748;&#26159;&#27809;&#26377;&#24310;&#26102;&#30340;&#65288;&#21363;<tt class="literal">redelivery-delay</tt>&#30340;&#20540;&#26159;0&#65289;&#12290;</p><p>&#21487;&#20197;&#20351;&#29992;&#36890;&#37197;&#31526;&#20026;&#19968;&#32452;&#22320;&#22336;&#23450;&#20041;&#20877;&#20256;&#36882;&#30340;&#24310;&#36831;&#65288;&#21442;&#35265;<a href="wildcard-syntax.html" title="Chapter&nbsp;13.&nbsp;&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;">Chapter&nbsp;13, <i>&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;</i></a>&#65289;&#12290;
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3918"></a>21.1.2.&nbsp;&#20363;&#23376;</h3></div></div><div></div></div><p>&#21442;&#35265; <a href="examples.html#examples.delayed-redelivery" title="11.1.12.&nbsp;&#24310;&#36831;&#20877;&#21457;&#36865;">Section&nbsp;11.1.12, &#8220;&#24310;&#36831;&#20877;&#21457;&#36865;&#8221;</a>&#12290;&#36825;&#26159;&#19968;&#20010;JMS&#24212;&#29992;&#20013;&#37197;&#32622;&#24310;&#36831;&#20877;&#20256;&#36882;&#30340;&#20363;&#23376;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3925"></a>21.2.&nbsp;&#27515;&#20449;&#22320;&#22336;</h2></div></div><div></div></div><p>&#36890;&#36807;&#23450;&#20041;&#19968;&#20010;<span class="italic">&#27515;&#20449;&#22320;&#22336;</span>&#20063;&#21487;&#20197;&#38450;&#27490;&#21516;&#19968;&#20010;&#28040;&#24687;&#34987;&#26080;&#20241;&#27490;&#22320;&#20256;&#36882;&#65306;
         &#24403;&#19968;&#20010;&#28040;&#24687;&#34987;&#37325;&#22797;&#20256;&#36882;&#19968;&#23450;&#27425;&#25968;&#21518;&#65292;&#23601;&#20250;&#20174;&#38431;&#21015;&#20013;&#21024;&#38500;&#24182;&#20256;&#36882;&#21040;&#23450;&#20041;&#22909;&#30340;&#27515;&#20449;&#22320;&#22336;&#20013;&#12290;</p><p>&#36825;&#20123;&#27515;&#20449;&#20013;&#30340;&#28040;&#24687;&#20043;&#21518;&#21487;&#20197;&#36716;&#21457;&#21040;&#26576;&#20010;&#38431;&#21015;&#20013;&#65292;&#20197;&#20379;&#31995;&#32479;&#31649;&#29702;&#21592;&#20998;&#26512;&#22788;&#29702;&#12290;</p><p>&#27599;&#20010;HornetQ&#30340;&#22320;&#22336;&#21487;&#20197;&#26377;&#19968;&#20010;&#27515;&#20449;&#22320;&#22336;&#12290;&#24403;&#19968;&#20010;&#28040;&#24687;&#34987;&#21453;&#22797;&#20256;&#36882;&#36798;&#19968;&#23450;&#27425;&#25968;&#26102;&#65292;&#23427;&#23601;&#20250;&#34987;&#20174;&#38431;&#21015;&#20013;&#21024;&#38500;&#24182;&#36865;&#21040;
         &#27515;&#20449;&#22320;&#22336;&#12290;&#36825;&#20123;<span class="emphasis"><em>&#27515;&#20449;</em></span>&#28040;&#24687;&#21487;&#20197;&#34987;&#25509;&#25910;&#36827;&#34892;&#20998;&#26512;&#22788;&#29702;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="undelivered-messages.configuring"></a>21.2.1.&nbsp;&#37197;&#32622;&#27515;&#20449;&#22320;&#22336;</h3></div></div><div></div></div><p>&#27515;&#20449;&#22320;&#22336;&#23450;&#20041;&#22312;&#22320;&#22336;&#35774;&#23450;&#20013;&#65288;address-setting&#65289;&#65306;</p><pre class="programlisting">
     &lt;!-- undelivered messages in exampleQueue will be sent to the dead letter address 
        deadLetterQueue after 3 unsuccessful delivery attempts
      --&gt;
     &lt;address-setting match="jms.queue.exampleQueue"&gt;
        &lt;dead-letter-address&gt;jms.queue.deadLetterQueue&lt;/dead-letter-address&gt;
        &lt;max-delivery-attempts&gt;3&lt;/max-delivery-attempts&gt;
     &lt;/address-setting&gt;
             </pre><p>&#22914;&#26524;&#27809;&#26377;&#23450;&#20041;<tt class="literal">dead-letter-address</tt>&#65292;&#28040;&#24687;&#22312;&#32463;&#36807;
               <tt class="literal">max-delivery-attempts</tt>&#27425;&#37325;&#22797;&#20256;&#36882;&#21518;&#34987;&#21024;&#38500;&#12290;</p><p>&#40664;&#35748;&#30340;&#37325;&#22797;&#20256;&#36882;&#27425;&#25968;&#20026;10&#12290;&#23558;<tt class="literal">max-delivery-attempts</tt>&#35774;&#23450;&#20026;-1
               &#34920;&#31034;&#26080;&#38480;&#27425;&#37325;&#22797;&#20256;&#36882;&#12290;</p><p>&#20363;&#22914;&#65292;&#23545;&#19968;&#32452;&#22320;&#22336;&#35774;&#32622;&#20102;&#19968;&#20010;&#36890;&#29992;&#30340;&#27515;&#20449;&#22320;&#22336;&#21518;&#65292;&#20877;&#23558;&#20854;&#20013;&#26576;&#20010;&#22320;&#22336;&#30340;<tt class="literal">max-delivery-attempts</tt>
            &#35774;&#23450;&#20026;-1&#26102;&#65292;&#37027;&#20040;&#21482;&#26377;&#36825;&#20010;&#22320;&#22336;&#30340;&#20877;&#20256;&#36882;&#27425;&#25968;&#26159;&#26080;&#38480;&#30340;&#12290;</p><p>&#21487;&#20197;&#20351;&#29992;&#36890;&#37197;&#31526;&#23545;&#19968;&#32452;&#22320;&#22336;&#35774;&#23450;&#27515;&#20449;&#22320;&#22336;&#65288;&#21442;&#35265;<a href="wildcard-syntax.html" title="Chapter&nbsp;13.&nbsp;&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;">Chapter&nbsp;13, <i>&#20102;&#35299; HornetQ &#36890;&#37197;&#31526;&#30340;&#35821;&#27861;</i></a>&#65289;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3969"></a>21.2.2.&nbsp;&#27515;&#20449;&#30340;&#23646;&#24615;</h3></div></div><div></div></div><p>&#20174;&#27515;&#20449;&#22320;&#22336;&#25509;&#25910;&#21040;&#30340;&#28040;&#24687;&#26377;&#20197;&#19979;&#23646;&#24615;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">_HQ_ORIG_ADDRESS</tt></p><p>&#36825;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#23646;&#24615;&#65292;&#23427;&#26159;&#35813;&#27515;&#20449;&#28040;&#24687;&#30340;<span class="emphasis"><em>&#21407;&#22987;&#22320;&#22336;</em></span>&#12290;</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3984"></a>21.2.3.&nbsp;&#20363;&#23376;</h3></div></div><div></div></div><p>&#21442;&#35265;<a href="examples.html#examples.dead-letter" title="11.1.11.&nbsp;&#27515;&#28040;&#24687;&#65288;Dead Letter&#65289;">Section&nbsp;11.1.11, &#8220;&#27515;&#28040;&#24687;&#65288;Dead Letter&#65289;&#8221;</a>&#12290;&#36825;&#20010;&#20363;&#23376;&#32473;&#20986;&#20102;&#22312;JMS&#24212;&#29992;&#20013;&#27515;&#20449;&#30340;&#37197;&#32622;&#19982;&#20351;&#29992;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring.delivery.count.persistence"></a>21.3.&nbsp;&#20256;&#36882;&#35745;&#25968;&#30340;&#25345;&#20037;&#21270;</h2></div></div><div></div></div><p>&#36890;&#24120;&#24773;&#20917;&#19979;HornetQ&#22312;&#19968;&#20010;&#28040;&#24687;&#34987;&#22238;&#28378;&#20043;&#21069;&#24182;&#19981;&#26356;&#26032;&#25345;&#20037;&#30340;&#20256;&#36882;&#35745;&#25968;&#65288;&#21363;&#22312;&#28040;&#24687;&#20256;&#36882;&#21040;&#25509;&#25910;&#32773;&#20043;&#21069;&#19981;&#20250;&#26356;&#26032;&#20256;&#36882;&#35745;&#25968;&#65289;&#12290;
         &#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#28040;&#24687;&#34987;&#25509;&#25910;&#12289;&#36890;&#30693;&#12289;&#28982;&#21518;&#34987;&#24536;&#25481;&#12290;&#36825;&#26679;&#23545;<span class="emphasis"><em>&#27599;&#19968;&#20010;&#28040;&#24687;</em></span>&#30340;&#20256;&#36882;&#37117;&#35201;&#26356;&#26032;&#19968;&#27425;&#25345;&#20037;&#30340;
         &#20256;&#36882;&#35745;&#25968;&#65292;&#20250;&#26174;&#33879;&#38477;&#20302;&#31995;&#32479;&#30340;&#24615;&#33021;&#12290;</p><p>&#20171;&#26159;&#22914;&#26524;&#22312;&#28040;&#24687;&#20256;&#36882;&#20043;&#21069;&#19981;&#36827;&#34892;&#25345;&#20037;&#20256;&#36882;&#35745;&#25968;&#30340;&#26356;&#26032;&#65292;&#26381;&#21153;&#22120;&#19968;&#26086;&#21457;&#29983;&#25925;&#38556;&#32780;&#23849;&#28291;&#65292;&#23601;&#20250;&#36896;&#25104;&#28040;&#24687;&#21487;&#33021;&#34987;&#20256;&#36882;&#20986;&#21435;&#32780;&#20256;&#36882;
         &#35745;&#25968;&#21364;&#27809;&#26377;&#27491;&#30830;&#21453;&#26144;&#20986;&#20256;&#36882;&#30340;&#32080;&#26524;&#12290;&#22312;&#24674;&#22797;&#38454;&#27573;&#65292;&#26381;&#21153;&#22120;&#23558;&#38169;&#35823;&#22320;&#23558;&#35813;&#28040;&#24687;&#30340;<tt class="literal">redelivered</tt>&#35774;&#20026;
         <tt class="literal">false</tt>&#32780;&#19981;&#26159;<tt class="literal">true</tt>&#12290; </p><p>&#36825;&#26679;&#26159;&#19981;&#31526;&#21512;&#20005;&#26684;&#30340;JMS&#35201;&#27714;&#30340;&#12290;&#22240;&#27492;HornetQ&#20801;&#35768;&#22312;&#28040;&#24687;&#20256;&#36882;&#21069;&#26356;&#26032;&#20256;&#36882;&#35745;&#25968;&#12290;&#20294;&#26159;&#40664;&#35748;&#19981;&#36825;&#26679;&#20570;&#65292;&#30446;&#30340;&#26159;&#20248;&#20808;&#32771;&#34385;
         &#20102;&#23427;&#23545;&#24615;&#33021;&#30340;&#24433;&#21709;&#12290;</p><p>&#35201;&#24819;&#25171;&#24320;&#20256;&#36882;&#35745;&#25968;&#26356;&#26032;&#21151;&#33021;&#65292;&#23558;<tt class="literal">hornetq-configuration.xml</tt>&#25991;&#20214;&#20013;&#30340;
            <tt class="literal">persist-delivery-count-before-delivery</tt>&#35774;&#20026;<tt class="literal">true</tt>&#21363;&#21487;&#65306;</p><pre class="programlisting">
&lt;persist-delivery-count-before-delivery&gt;true&lt;/persist-delivery-count-before-delivery&gt;
      </pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="send-guarantees.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="message-expiry.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;20.&nbsp;&#21457;&#36865;&#19982;&#25552;&#20132;&#30340;&#20445;&#35777;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;22.&nbsp;&#36807;&#26399;&#30340;&#28040;&#24687;</td></tr></table></div></body></html>