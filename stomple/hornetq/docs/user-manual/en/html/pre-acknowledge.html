<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;29.&nbsp;Pre-Acknowledge Mode</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1 User Manual"><link rel="up" href="index.html" title="HornetQ 2.1 User Manual"><link rel="previous" href="message-grouping.html" title="Chapter&nbsp;28.&nbsp;Message Grouping"><link rel="next" href="management.html" title="Chapter&nbsp;30.&nbsp;Management"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;29.&nbsp;Pre-Acknowledge Mode</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="message-grouping.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="management.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="pre-acknowledge"></a>Chapter&nbsp;29.&nbsp;Pre-Acknowledge Mode</h2></div></div><div></div></div><p>JMS specifies 3 acknowledgement modes:</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">AUTO_ACKNOWLEDGE</tt></p></li><li><p><tt class="literal">CLIENT_ACKNOWLEDGE</tt></p></li><li><p><tt class="literal">DUPS_OK_ACKNOWLEDGE</tt></p></li></ul></div><p>However there is another case which is not supported by JMS: In some cases you can afford
      to lose messages in event of failure, so it would make sense to acknowledge the message on the
      server <span class="emphasis"><em>before</em></span> delivering it to the client.</p><p>This extra mode is supported by HornetQ and will call it
         <span class="emphasis"><em>pre-acknowledge</em></span> mode.</p><p>The disadvantage of acknowledging on the server before delivery is that the message will be
      lost if the system crashes <span class="emphasis"><em>after</em></span> acknowledging the message on the server
      but <span class="emphasis"><em>before</em></span> it is delivered to the client. In that case, the message is
      lost and will not be recovered when the system restart.</p><p>Depending on your messaging case, <tt class="literal">pre-acknowledgement</tt> mode can avoid
      extra network traffic and CPU at the cost of coping with message loss.</p><p>An example of a use case for pre-acknowledgement is for stock price update messages. With
      these messages it might be reasonable to lose a message in event of crash, since the next
      price update message will arrive soon, overriding the previous price. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Please note, that if you use pre-acknowledge mode, then you will lose transactional
         semantics for messages being consumed, since clearly they are being acknowledged first on
         the server, not when you commit the transaction. This may be stating the obvious but we
         like to be clear on these things to avoid confusion!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pre-acknowledge.configure"></a>29.1.&nbsp;Using PRE_ACKNOWLEDGE</h2></div></div><div></div></div><p>This can be configured in the <tt class="literal">hornetq-jms.xml</tt> file on the <tt class="literal">connection factory</tt> like this:</p><pre class="programlisting">&lt;connection-factory name="ConnectionFactory"&gt;
      &lt;connectors&gt;
         &lt;connector-ref connector-name="netty-connector"/&gt;
      &lt;/connectors&gt;
      &lt;entries&gt;
         &lt;entry name="ConnectionFactory"/&gt;
      &lt;/entries&gt;
      &lt;pre-acknowledge&gt;true&lt;/pre-acknowledge&gt;
&lt;/connection-factory&gt;</pre><p>Alternatively, to use pre-acknowledgement mode using the JMS API, create a JMS Session
         with the <tt class="literal">HornetQSession.PRE_ACKNOWLEDGE</tt> constant.</p><pre class="programlisting">
// messages will be acknowledge on the server *before* being delivered to the client
Session session = connection.createSession(false, HornetQSession.PRE_ACKNOWLEDGE);
      </pre><p>Or you can set pre-acknowledge directly on the <tt class="literal">HornetQConnectionFactory</tt> instance using the setter method.</p><p>To use pre-acknowledgement mode using the core API you can set it directly on the
            <tt class="literal">ClientSessionFactory</tt> instance using the setter method.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5437"></a>29.2.&nbsp;Example</h2></div></div><div></div></div><p>See <a href="examples.html#examples.pre-acknowledge" title="11.1.35.&nbsp;Pre-Acknowledge">Section&nbsp;11.1.35, &#8220;Pre-Acknowledge&#8221;</a> for an example which shows how to use
         pre-acknowledgement mode with JMS.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="message-grouping.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="management.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;28.&nbsp;Message Grouping&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;30.&nbsp;Management</td></tr></table></div></body></html>