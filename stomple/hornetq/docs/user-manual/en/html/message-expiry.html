<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;22.&nbsp;Message Expiry</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HornetQ 2.1 User Manual"><link rel="up" href="index.html" title="HornetQ 2.1 User Manual"><link rel="previous" href="undelivered-messages.html" title="Chapter&nbsp;21.&nbsp;Message Redelivery and Undelivered Messages"><link rel="next" href="large-messages.html" title="Chapter&nbsp;23.&nbsp;Large Messages"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;22.&nbsp;Message Expiry</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="undelivered-messages.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="large-messages.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="message-expiry"></a>Chapter&nbsp;22.&nbsp;Message Expiry</h2></div></div><div></div></div><p>Messages can be set with an optional <span class="emphasis"><em>time to live</em></span> when sending
      them.</p><p>HornetQ will not deliver a message to a consumer after it's time to live has been exceeded.
      If the message hasn't been delivered by the time that time to live is reached the server can
      discard it.</p><p>HornetQ's addresses can be assigned a expiry address so that, when messages are expired,
      they are removed from the queue and sent to the expiry address. Many different queues can be
      bound to an expiry address. These <span class="emphasis"><em>expired</em></span> messages can later be consumed
      for further inspection.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4315"></a>22.1.&nbsp;Message Expiry</h2></div></div><div></div></div><p>Using HornetQ Core API, you can set an expiration time directly on the message:</p><pre class="programlisting">
// message will expire in 5000ms from now
message.setExpiration(System.currentTimeMillis() + 5000);         
              </pre><p>JMS MessageProducer allows to set a TimeToLive for the messages it sent:</p><pre class="programlisting">
// messages sent by this producer will be retained for 5s (5000ms) before expiration           
producer.setTimeToLive(5000);
        </pre><p>Expired messages which are consumed from an expiry address have the following
         properties:</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">_HQ_ORIG_ADDRESS</tt></p><p>a String property containing the <span class="emphasis"><em>original address</em></span> of the
               expired message </p></li><li><p><tt class="literal">_HQ_ACTUAL_EXPIRY</tt></p><p>a Long property containing the <span class="emphasis"><em>actual expiration time</em></span> of the
               expired message</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-expiry.configuring"></a>22.2.&nbsp;Configuring Expiry Addresses</h2></div></div><div></div></div><p>Expiry address are defined in the address-setting configuration:</p><pre class="programlisting">
&lt;!-- expired messages in exampleQueue will be sent to the expiry address expiryQueue --&gt;
&lt;address-setting match="jms.queue.exampleQueue"&gt;
   &lt;expiry-address&gt;jms.queue.expiryQueue&lt;/expiry-address&gt;
&lt;/address-setting&gt;
        </pre><p>If messages are expired and no expiry address is specified, messages are simply removed
         from the queue and dropped. Address wildcards can be used to configure expiry address for a
         set of addresses (see <a href="wildcard-syntax.html" title="Chapter&nbsp;13.&nbsp;Understanding the HornetQ Wildcard Syntax">Chapter&nbsp;13, <i>Understanding the HornetQ Wildcard Syntax</i></a>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring.expiry.reaper"></a>22.3.&nbsp;Configuring The Expiry Reaper Thread</h2></div></div><div></div></div><p>A reaper thread will periodically inspect the queues to check if messages have
         expired.</p><p>The reaper thread can be configured with the following properties in <tt class="literal">hornetq-configuration.xml</tt></p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">message-expiry-scan-period</tt></p><p>How often the queues will be scanned to detect expired messages (in milliseconds,
               default is 30000ms, set to <tt class="literal">-1</tt> to disable the reaper thread)</p></li><li><p><tt class="literal">message-expiry-thread-priority</tt></p><p>The reaper thread priority (it must be between 0 and 9, 9 being the highest
               priority, default is 3)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4383"></a>22.4.&nbsp;Example</h2></div></div><div></div></div><p>See <a href="examples.html#examples.expiry" title="11.1.28.&nbsp;Message Expiration">Section&nbsp;11.1.28, &#8220;Message Expiration&#8221;</a> for an example which shows how message expiry is
         configured and used with JMS.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="undelivered-messages.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="large-messages.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;21.&nbsp;Message Redelivery and Undelivered Messages&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;23.&nbsp;Large Messages</td></tr></table></div></body></html>